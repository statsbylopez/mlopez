<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Statsbylopez on Statsbylopez</title>
    <link>/</link>
    <description>Recent content in Statsbylopez on Statsbylopez</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <copyright>&amp;copy; 2018</copyright>
    <lastBuildDate>Wed, 20 Apr 2016 00:00:00 +0000</lastBuildDate>
    <atom:link href="/" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Don’t running backs matter?</title>
      <link>/post/don-t-running-backs-matter/</link>
      <pubDate>Wed, 18 Nov 2020 00:00:00 +0000</pubDate>
      
      <guid>/post/don-t-running-backs-matter/</guid>
      <description>&lt;p&gt;The first of Tomas Plekanec’s 15 seasons in the NHL came in 2005-06, which coincided with the league’s introduction of a shootout.&lt;/p&gt;
&lt;p&gt;The shootout was not kind to Plekanec. Among all NHL players with at least 20 attempts, Plekanec’s career shootout percentage of 13% is the lowest league history. A deeper look into Plekanec’s &lt;a href=&#34;https://www.hockey-reference.com/players/p/plekato01.html&#34;&gt;shootout usage&lt;/a&gt; reveals an interesting pattern:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr class=&#34;header&#34;&gt;
&lt;th&gt;Seasons&lt;/th&gt;
&lt;th&gt;# Years&lt;/th&gt;
&lt;th&gt;Plekanec Shootout Attempts&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td&gt;2005-06 to 2014-15&lt;/td&gt;
&lt;td&gt;10&lt;/td&gt;
&lt;td&gt;23&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td&gt;2015-16 to 2018-19&lt;/td&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Each of Plekanec’s shootout attempts occured in his first 10 seasons, and his success rate was so bad in that timeframe that he never again got an opportunity.&lt;/p&gt;
&lt;p&gt;Plekanec’s usage underpins a deeper limitation of analyzing shootout data, in that we only get to observe players in the shootout if their coaches give them an opportunity. This form of selection bias is, in part, why it took &lt;a href=&#34;https://statsbylopez.com/2014/03/12/nhl-shootouts-arent-random-so-lets-stop-calling-them-that/&#34;&gt;researchers&lt;/a&gt; so long to identify that shootouts were not the coin flips that we initially thought they were. Turns out, not only were shootouts &lt;em&gt;not&lt;/em&gt; random, but the best shooters (e.g, the opposite of Plekanec) were likely worth more than a half a million dollars per year in salary based on shootout performances alone (see &lt;a href=&#34;https://statsbylopez.files.wordpress.com/2013/08/jss_nhl-21.pdf&#34;&gt;Schuckers and I on this topic&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;Perhaps a more optimistic view is that Plekanec’s coaches were rational in evaluating him. They correctly recognized Plekanec as a below average shootout player, and didn’t give him any further opportunities.&lt;/p&gt;
&lt;p&gt;This post discusses how a similar trend seems to exist within an entire positional group: NFL running backs.&lt;/p&gt;
&lt;div id=&#34;expected-rush-yards-and-nfl-data&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Expected rush yards and NFL data&lt;/h2&gt;
&lt;p&gt;The &lt;a href=&#34;https://www.kaggle.com/c/nfl-big-data-bowl-2020/discussion/119400&#34;&gt;top solution&lt;/a&gt; in the NFL’s 2020 Big Data Bowl used machine learning to estimate the probability of a ball carrier reaching each possible yard line on an NFL handoff. With the winning code as a baseline, the league’s Next Gen Stats media team has integrated &lt;a href=&#34;https://www.nfl.com/news/next-gen-stats-intro-to-expected-rushing-yards&#34;&gt;a new suite of metrics&lt;/a&gt; based on this algorithm. This data is provided to NFL clubs and media, and has even been used with wide receiver models (&lt;a href=&#34;https://twitter.com/NextGenStats/status/1328803741856903170&#34;&gt;Example&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;One new metric is expected rush yards, defined as the average number of yards that an NFL player would gain, using the speed, acceleration, direction, and location of the 22 players on the field at handoff. The stat appears &lt;a href=&#34;https://operations.nfl.com/stats-central/stats-articles/what-the-top-predictions-looked-like-in-the-nfls-big-data-bowl/&#34;&gt;well calibrated&lt;/a&gt;, as judged by out-of-sample prediction on 2019 rushing plays.&lt;/p&gt;
&lt;p&gt;Calibration doesn’t always entail repeatability, and one unknown with expected yards is whether or not overperformance (e.g, carring for more yards than was expected) is due to skill or luck. This post uses expected yards as a baseline for two arguments:&lt;/p&gt;
&lt;ol style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;&lt;p&gt;There exists a selection bias in how running backs are given carries.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Despite this limitation, there’s a non-zero consistency in running back performance relative to expectation.&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;div id=&#34;remember-legarrette-blount&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Remember LeGarrette Blount?&lt;/h2&gt;
&lt;p&gt;Having expected yards makes it straightforward to estimate performances above or below average. If a running back was expected to pick up 3.5 yards and gained 6, he gets credited with +2.5 yards over expectation. A gain of 2 yards? -1.5 yards over expectation.&lt;/p&gt;
&lt;p&gt;Here’s a table that shows the five players with the highest (in blue) and lowest (red) cumulative yardages over expectation in the 2018 regular season, alongside the number of carries each player received in 2019.&lt;/p&gt;
&lt;style&gt;html {
  font-family: -apple-system, BlinkMacSystemFont, &#39;Segoe UI&#39;, Roboto, Oxygen, Ubuntu, Cantarell, &#39;Helvetica Neue&#39;, &#39;Fira Sans&#39;, &#39;Droid Sans&#39;, Arial, sans-serif;
}

#wlvaofjgby .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#wlvaofjgby .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wlvaofjgby .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#wlvaofjgby .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#wlvaofjgby .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wlvaofjgby .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wlvaofjgby .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#wlvaofjgby .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#wlvaofjgby .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#wlvaofjgby .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#wlvaofjgby .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#wlvaofjgby .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#wlvaofjgby .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#wlvaofjgby .gt_from_md &gt; :first-child {
  margin-top: 0;
}

#wlvaofjgby .gt_from_md &gt; :last-child {
  margin-bottom: 0;
}

#wlvaofjgby .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#wlvaofjgby .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#wlvaofjgby .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wlvaofjgby .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#wlvaofjgby .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wlvaofjgby .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#wlvaofjgby .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#wlvaofjgby .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wlvaofjgby .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wlvaofjgby .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#wlvaofjgby .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wlvaofjgby .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#wlvaofjgby .gt_left {
  text-align: left;
}

#wlvaofjgby .gt_center {
  text-align: center;
}

#wlvaofjgby .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#wlvaofjgby .gt_font_normal {
  font-weight: normal;
}

#wlvaofjgby .gt_font_bold {
  font-weight: bold;
}

#wlvaofjgby .gt_font_italic {
  font-style: italic;
}

#wlvaofjgby .gt_super {
  font-size: 65%;
}

#wlvaofjgby .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
&lt;/style&gt;
&lt;div id=&#34;wlvaofjgby&#34; style=&#34;overflow-x:auto;overflow-y:auto;width:auto;height:auto;&#34;&gt;&lt;table class=&#34;gt_table&#34;&gt;
  &lt;thead class=&#34;gt_header&#34;&gt;
    &lt;tr&gt;
      &lt;th colspan=&#34;3&#34; class=&#34;gt_heading gt_title gt_font_normal&#34; style&gt;&lt;strong&gt;2018 Performance --&amp;gt; 2019 Opportunity&lt;/strong&gt;&lt;/th&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th colspan=&#34;3&#34; class=&#34;gt_heading gt_subtitle gt_font_normal gt_bottom_border&#34; style&gt;&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;thead class=&#34;gt_col_headings&#34;&gt;
    &lt;tr&gt;
      &lt;th class=&#34;gt_col_heading gt_columns_bottom_border gt_left&#34; rowspan=&#34;1&#34; colspan=&#34;1&#34;&gt;Rusher&lt;/th&gt;
      &lt;th class=&#34;gt_col_heading gt_columns_bottom_border gt_right&#34; rowspan=&#34;1&#34; colspan=&#34;1&#34;&gt;Yards over average, 2018&lt;/th&gt;
      &lt;th class=&#34;gt_col_heading gt_columns_bottom_border gt_right&#34; rowspan=&#34;1&#34; colspan=&#34;1&#34;&gt;# Carries, 2019&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody class=&#34;gt_table_body&#34;&gt;
    &lt;tr&gt;
      &lt;td class=&#34;gt_row gt_left&#34; style=&#34;color: blue;&#34;&gt;Saquon Barkley&lt;/td&gt;
      &lt;td class=&#34;gt_row gt_right&#34; style=&#34;color: blue;&#34;&gt;293&lt;/td&gt;
      &lt;td class=&#34;gt_row gt_right&#34; style=&#34;color: blue;&#34;&gt;213&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td class=&#34;gt_row gt_left&#34; style=&#34;color: blue;&#34;&gt;Nick Chubb&lt;/td&gt;
      &lt;td class=&#34;gt_row gt_right&#34; style=&#34;color: blue;&#34;&gt;240&lt;/td&gt;
      &lt;td class=&#34;gt_row gt_right&#34; style=&#34;color: blue;&#34;&gt;295&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td class=&#34;gt_row gt_left&#34; style=&#34;color: blue;&#34;&gt;Derrick Henry&lt;/td&gt;
      &lt;td class=&#34;gt_row gt_right&#34; style=&#34;color: blue;&#34;&gt;218&lt;/td&gt;
      &lt;td class=&#34;gt_row gt_right&#34; style=&#34;color: blue;&#34;&gt;287&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td class=&#34;gt_row gt_left&#34; style=&#34;color: blue;&#34;&gt;Kerryon Johnson&lt;/td&gt;
      &lt;td class=&#34;gt_row gt_right&#34; style=&#34;color: blue;&#34;&gt;177&lt;/td&gt;
      &lt;td class=&#34;gt_row gt_right&#34; style=&#34;color: blue;&#34;&gt;110&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td class=&#34;gt_row gt_left&#34; style=&#34;color: blue;&#34;&gt;Joe Mixon&lt;/td&gt;
      &lt;td class=&#34;gt_row gt_right&#34; style=&#34;color: blue;&#34;&gt;171&lt;/td&gt;
      &lt;td class=&#34;gt_row gt_right&#34; style=&#34;color: blue;&#34;&gt;274&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td class=&#34;gt_row gt_left&#34; style=&#34;color: red;&#34;&gt;Elijah McGuire&lt;/td&gt;
      &lt;td class=&#34;gt_row gt_right&#34; style=&#34;color: red;&#34;&gt;-65&lt;/td&gt;
      &lt;td class=&#34;gt_row gt_right&#34; style=&#34;color: red;&#34;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td class=&#34;gt_row gt_left&#34; style=&#34;color: red;&#34;&gt;Nyheim Hines&lt;/td&gt;
      &lt;td class=&#34;gt_row gt_right&#34; style=&#34;color: red;&#34;&gt;-66&lt;/td&gt;
      &lt;td class=&#34;gt_row gt_right&#34; style=&#34;color: red;&#34;&gt;52&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td class=&#34;gt_row gt_left&#34; style=&#34;color: red;&#34;&gt;Jordan Howard&lt;/td&gt;
      &lt;td class=&#34;gt_row gt_right&#34; style=&#34;color: red;&#34;&gt;-95&lt;/td&gt;
      &lt;td class=&#34;gt_row gt_right&#34; style=&#34;color: red;&#34;&gt;119&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td class=&#34;gt_row gt_left&#34; style=&#34;color: red;&#34;&gt;LeGarrette Blount&lt;/td&gt;
      &lt;td class=&#34;gt_row gt_right&#34; style=&#34;color: red;&#34;&gt;-146&lt;/td&gt;
      &lt;td class=&#34;gt_row gt_right&#34; style=&#34;color: red;&#34;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td class=&#34;gt_row gt_left&#34; style=&#34;color: red;&#34;&gt;LeSean McCoy&lt;/td&gt;
      &lt;td class=&#34;gt_row gt_right&#34; style=&#34;color: red;&#34;&gt;-155&lt;/td&gt;
      &lt;td class=&#34;gt_row gt_right&#34; style=&#34;color: red;&#34;&gt;98&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
  
  
&lt;/table&gt;&lt;/div&gt;
&lt;p&gt;The five best running backs in the 2018 season based on yardage above expectation received an average of 236 carries in 2019. The five running backs furthest below expectation, by comparison, received an average of 54 carries, including LeGarrette Blount and Elijah McGuire, neither of whom saw the field in 2019 (no injuries appear evident).&lt;/p&gt;
&lt;p&gt;Why does this matter?&lt;/p&gt;
&lt;p&gt;First, there’s an immediate link to Thomas Plekanec in the shootout. We can’t observe what we can’t see, which means that for the same reason Plekanec stopped getting chances at shootouts, Legarrette Blount stopped getting handoffs in NFL games. Alternatively, Derrick Henry keeps getting the ball, sort of like Team USA going to &lt;a href=&#34;https://www.youtube.com/watch?v=MUxJXzKY4LE&#34;&gt;TJ Oshie&lt;/a&gt; in their Olympic shootout against Russia.&lt;/p&gt;
&lt;p&gt;Second, at some level, this suggests that NFL coaches are rational in their running back usage. Assuming there is some signal to rushing yards over expectation, it makes more sense to feed the Barkley’s, Chubb’s, and Henry’s of the world than it does the McCoy’s, Blount’s, and Howard’s, and that’s why they keep doing it. (&lt;em&gt;Postscript: after I started this post, Howard was cut by the Dolphins&lt;/em&gt;)&lt;/p&gt;
&lt;p&gt;Third, perhaps there’s something that coaches are following that is &lt;em&gt;not&lt;/em&gt; seen in traditional stats. Player carries in 2019 was more closely tied to 2018 yards above average per carry (correlation of 0.50) than 2018 yards per carry (correlation of 0.37).&lt;/p&gt;
&lt;p&gt;Finally, if we’re interested in the repeatability of expected yards (and in the repeatability of yards over expected), we have to reckon with the reality that not all players will themselves be allowed to repeat. Perhaps year over year correlations are not the best approach.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;does-expected-yards-over-average-predict-itself&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Does expected yards over average predict itself?&lt;/h2&gt;
&lt;p&gt;The stability of yards over average mostly unknown. I’ll use a larger sample of plays (through Week 9 of 2020) to find some evidence that players that are above average are more likely than not to stay above average.&lt;/p&gt;
&lt;p&gt;Let’s start by splitting ball carriers into random sets of carries. Instead of looking year over year (which would miss players that don’t play a season after poor performances), I’ll split each back’s carries over the entirety of data evenly into two groups, each corresponding to roughly half of their opportunities. In each split, median yards over expectation are calculated in the two groups. I’ve done this 1000 times – nine examples of which are shown below.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/img/ey_out.png&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Backs in the top right of the chart register better-than-typical performances in both random splits of the data, while backs in the bottom left are worse than average in both. Correlation coefficients within each plot are provided in the titles.&lt;/p&gt;
&lt;p&gt;Two images are shown where their dots appear: Blount and Henry. In all 9 splits of the data, Henry is over average while Blount is below. It shouldn’t be surprising that Henry’s performance looks better than Blount’s over the last few years, but the fact that this is a repeatable finding is notable.&lt;/p&gt;
&lt;p&gt;Replicating this process 1000 times, the typical correlation coefficient was 0.36 (95 percent of correlation coefficients were between 0.18 and 0.52). In sum, this suggests there is &lt;em&gt;some&lt;/em&gt; repeatability to yards over average.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;what-about-other-metrics-that-use-expected-yards&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;What about other metrics that use expected yards?&lt;/h2&gt;
&lt;p&gt;More generally, I looked at four metrics as far as repeatability.&lt;/p&gt;
&lt;ol style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;Yards Over Expectation (median, as shown above)&lt;/li&gt;
&lt;li&gt;Success Probability, defined as the likelihood the ball carrier has a successful play (40 percent of yards to go on 1st down, 50 percent on 2nd down, 100 percent on 3rd/4th down) given the information known at handoff&lt;/li&gt;
&lt;li&gt;Expected Yards&lt;/li&gt;
&lt;li&gt;Rush Over Expectation Percent, defined as the percent of a rusher’s carries where he exceeds Expected Yards&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;The following chart tracks split-sample correlations of these four metrics across the 1000 samples, for two sample size cutoffs (50 and 150 handoff plays).&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/img/corr_coeff.png&#34; /&gt;&lt;/p&gt;
&lt;p&gt;The &lt;em&gt;most&lt;/em&gt; repeatable metric is Success Probability, with a typical correlation coefficient of 0.63. &lt;em&gt;Several&lt;/em&gt; football factors tie into Success Probability, including coaching, play calling, blocking, and defensive scheme. This metric’s relative consistency is a sign that players that tend to have opportunities for successful plays are likely to keep that up (and that deeper work to separate out player versus team is likely needed).&lt;/p&gt;
&lt;p&gt;Right behind Success Probability is Expected Yards. Because teams use running backs differently based on down and distance, it’s likely that the space (and available yardage) vary consistently between ball carriers. You can check out an example plot of 2020 expected yards data &lt;a href=&#34;https://twitter.com/StatsbyLopez/status/1326245845155647492&#34;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Yards Over Expectation and Rush Over Expectation Percent were both &lt;em&gt;less&lt;/em&gt; stable, but still appear to show a non-zero consistency. For Yards Over Expectation, the typical correlation coefficient &lt;a href=&#34;https://fantasy.fangraphs.com/the-updated-xstats-and-their-year-to-year-correlations/&#34;&gt;roughly corresponds&lt;/a&gt; to the year-over-year correlations of both an MLB pitchers’ batting average allowed and on base percentage allowed.&lt;/p&gt;
&lt;p&gt;To sum: there are appear to be non-zero split sample correlations when looking at the expected yards suite of metrics. The two metrics more closely tied to team usage and coaching are more consistent, while metrics corresponding to individual performance are less so.&lt;/p&gt;
&lt;p&gt;A few comments to end with:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;How useful are these positive correlations? Do running backs now matter? The combination of selection bias/rational coaching (e.g, the Tomas Plekanec problem) and the non-zero consistency of running back performance is worth keeping in mind.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;I still haven’t done a great job of accounting for drop-out. If a ball carrier had 49 career carries and they were all terrible, he wouldn’t appear in our data set.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Not all yards above average should be treated equally. Last year, I used running back &lt;a href=&#34;https://statsbylopez.netlify.app/post/assessing-running-back-performance-using-distributions/&#34;&gt;percentile&lt;/a&gt; and perhaps that’s a metric I’ll look at into again in the offseason.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;There’s a reasonable amount of noise between the correlations in each split sample. I’d recommend folks (including myself, going forward) be up front about how they choose their training and test data, and to check how much of an impact that decision has on findings.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Expected yards uses ball carrier speed at handoff, which could artificially punish or reward players based on how they are moving. Perhaps the most optimal approach for calculating expected yards would impute an average running back speed to be expected on a typical play.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>Assessing running back performance using distributions</title>
      <link>/post/assessing-running-back-performance-using-distributions/</link>
      <pubDate>Tue, 28 Jan 2020 00:00:00 +0000</pubDate>
      
      <guid>/post/assessing-running-back-performance-using-distributions/</guid>
      <description>&lt;p&gt;Most often, running backs in the National Football League are compared by taking summary statistics from each play. Traditional metrics include yards-per-carry, expected points added per play (EPA), and win probability added per play (WPA). While comparing players based on these their averages is the straightforward, means can be sensitive to outlying observations and distributions with heavy tails. Unfortunately, yards, EPA, and WPA are all strongly skewed, which means that taking averages may not be an optimal approach.&lt;/p&gt;
&lt;p&gt;As part of the NFL’s Big Data Bowl, participants dove deeper into ball carrier performance. In this post, I’ll use one set of Big Data Bowl predictions (provided by the Zoo, &lt;a href=&#34;https://www.kaggle.com/c/nfl-big-data-bowl-2020/discussion/119400&#34;&gt;link&lt;/a&gt;) to examine two newer metrics – yards over expectation and yardage percentiles.&lt;/p&gt;
&lt;div id=&#34;yards-over-expectation&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Yards over expectation&lt;/h2&gt;
&lt;p&gt;The first way to look at Big Data Bowl projections was to boil each carry down to a single number peformance – expected yards. Using the Zoo’s predictions, each carry’s expected yards is the cumulative sum of the probability that the ball carrier finished with each yardage total, multiplied by that yardage total. Ex: if a back has a 25% chance at losing 1 yard (-1), a 25 percent chance at 0 yards, and a 50 percent chance at 1 yard, the expected yards gained would be 0.25 (&lt;span class=&#34;math inline&#34;&gt;\(-1*0.25 + 0*0.25 + 1*0.50 = 0.25\)&lt;/span&gt;).&lt;/p&gt;
&lt;p&gt;Here’s are two histograms, both for yards (left side) and of yards over expectation (right side).&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/post/2020-01-28-assessing-running-back-performance-using-distributions_files/figure-html/unnamed-chunk-1-1.png&#34; width=&#34;768&#34; /&gt;&lt;/p&gt;
&lt;p&gt;The distribution of yards above expectation is centered at 0 and is slightly more symmetric than the distribution for yards, but there remain outliers and a heavy tail to the right. That is, despite the Zoo’s projections &lt;a href=&#34;https://operations.nfl.com/stats-central/stats-articles/what-the-top-predictions-looked-like-in-the-nfls-big-data-bowl/&#34;&gt;being accurate on aggregate&lt;/a&gt;, yards over expectation boasts a fairly similar distribution to yards.&lt;/p&gt;
&lt;p&gt;The skewness of each distribution, combined with the relatively small number of carries that are afforded to running backs each season, can make it difficult to infer much about player talent using averages alone. Damien Williams’ 91 yard &lt;a href=&#34;https://www.youtube.com/watch?v=lseCV0H2LPk&#34;&gt;touchdown&lt;/a&gt; run, for example, was only expected to gain 5.2 yards. In the histograms above, there’s not much difference between 91 yards and 85.8 yards above expectation.&lt;/p&gt;
&lt;div id=&#34;assessing-repeatability-using-yards-over-expectation&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Assessing repeatability using yards over expectation&lt;/h3&gt;
&lt;p&gt;A frequent goal of sports analytics is to find players that are able to consistently able to outperform expectations. This is generally done by splitting samples into two samples (say, odd games and even games, training and test data, or year over year preformances). Steph Curry shooting 3-pointers, Lionel Messi on set pieces, and Mike Trout’s exit velocity are examples of players who will consistently outperform expectations.&lt;/p&gt;
&lt;p&gt;Running back metrics have traditionally been shown to be unpredictable, and the skewness of the distributions above is part of the reason why. Here’s a histogram of yards over expectation for Damien Williams’ 82 carries.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/post/2020-01-28-assessing-running-back-performance-using-distributions_files/figure-html/unnamed-chunk-2-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Williams has 81 carries with between -10 and 7 yards +/- expectation, and one carry with +85.8 yards over average. If you split Williams’ carries into two even subsamples, each with half of his carries, the 91 yards (or 85.8 yards above expectation) is only going to end up in one of them. Doesn’t really matter how many times you sample, and you could even sample with replacement. At the end of the day, the inclusion of that one play will determine how consistent (or inconsistent) you view Williams’ season.&lt;/p&gt;
&lt;p&gt;More generally, the chart below splits Big Data Bowl predictions into two random data sets (sample’s 1 and 2), and compares each RBs average yards gained above and below expectation between the two samples.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/post/2020-01-28-assessing-running-back-performance-using-distributions_files/figure-html/unnamed-chunk-3-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;There’s potentially a small link between ball carrier performance in the two samples, but it’s hard to separate from noise (even scatter). Sampling in this fashion 1000 times averages a correlation coefficient of 0.17. By and large, there’s a weak, linear association in yardage above/below expectation when cut between two random splits of data.&lt;/p&gt;
&lt;p&gt;If you are curious where Williams is, he’s always in the top left (if his touchdown run was in sample 2) or bottom right (sample 1), depending on chance.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&#34;what-else-is-there&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;What else is there?&lt;/h2&gt;
&lt;p&gt;Big Data Bowl predictions aren’t just expected yards – they’re distributions. Here’s the empirical cumulative distribution function (CDF) for two sample carries, a Cordarrelle Patterson two-yard loss and a Raheem Mostert 41-yard touchdown run.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/post/2020-01-28-assessing-running-back-performance-using-distributions_files/figure-html/unnamed-chunk-4-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;There’s basically nothing about the two plays that’s similar. As an example, Mostert was as likely to reach 12 yards as Patterson was to lose a yard (50%), which is a fairly wide gap in terms of modal performance.&lt;/p&gt;
&lt;p&gt;Using expected yards, Mostert overperformed by about 30 yards, while Patterson fell about a yard short. But I’m not sure those numbers tell the best story. There’s basically 0 chance Patterson could’ve finished with 30-yards over expectation on his carry (even though his play started near midfield). If we judge by yardage over expectation, Patterson would need to replicate his play seven times, and on each play gain seven yards (probability ~ 0) to match Mostert’s yards above average.&lt;/p&gt;
&lt;p&gt;In place of yardage expectations, there’s a more intuitive way of comparing Patterson’s run to Mostert’s – their CDFs. That is, each point on the y-axis in the chart above maps to yardage gains that are equivalent between the two runs. The following chart shows how Patterson losing two yards was equivalent to a carry where Mostert gained 8 yards. Both gains correspond to roughly 0.30 on the y-axis.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/post/2020-01-28-assessing-running-back-performance-using-distributions_files/figure-html/unnamed-chunk-5-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Mostert picking up eight yards is the closest match to Patterson losing two yards. As an alternative comparison, an eight-yard gain for Patterson is roughly as likely as what Mostert did on his touchdown run.&lt;/p&gt;
&lt;p&gt;There are a few side benefits of using these CDFs.&lt;/p&gt;
&lt;p&gt;First, they’re intuitive – the cdf is a percentile. Patterson losing 2 yards and Mostert (hypothetically) gaining 8 yards both correspond to the 30th percentile. That is, 30% of running backs would be expected to perform at or below those yardage marks.&lt;/p&gt;
&lt;p&gt;Second, percentiles will (roughly) follow a uniform distribution, which means fewer, if any, outliers.&lt;/p&gt;
&lt;div id=&#34;what-do-cdfs-from-the-big-data-bowl-tell-us&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;What do CDFs from the Big Data Bowl tell us?&lt;/h3&gt;
&lt;p&gt;Using all plays in the Big Data Bowl, I mapped each observed yardage gained to the corresponding percentile. That percentile roughly corresponds to a play-level performance for a running back, using the distribution of The Zoo’s predictions. Higher is better.&lt;/p&gt;
&lt;p&gt;Here are density plots looking at the percentiles for the 28 players with at least 100 carries in the sample. Players are ordered in order from lowest to highest median percentiles.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/post/2020-01-28-assessing-running-back-performance-using-distributions_files/figure-html/unnamed-chunk-6-1.png&#34; width=&#34;768&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Ezekial Elliott’s typical carry ended in the 67th-percentile of what a typical running back would gain, while Devonta Freeman was in the 37th-percentile. Roughly, it was just as common for Freeman to finish in the top-quarter of running back distributions as it was for Elliott to finish in the top half. Le’Veon Bell, Chris Carson, and Jordan Howard are other names atop the chart.&lt;/p&gt;
&lt;p&gt;As a final step, we check to see if there’s any more consistency in running back percentile scores. The chart below splits again splits players into two samples randomly, but this time focuses on the average percentile for each run.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/post/2020-01-28-assessing-running-back-performance-using-distributions_files/figure-html/unnamed-chunk-7-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Freeman, Elliott, and Williams are all highlighted, with performances that appear consistent in the two samples. Williams, with his long touchdown run reduced from extreme outlier to simply the 100th-percentile, is no longer as impacted by that one big carry.&lt;/p&gt;
&lt;p&gt;The correlation coefficient in the above plot is 0.40 – that matches what occurs if you take a few thousand such random samples.&lt;/p&gt;
&lt;p&gt;To repeat: using percentile in place of yards +/-, even when looking at the identical set of plays, allows us to upp our split sample correlation coefficient from 0.17 to 0.40 when looking at running back performance.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&#34;whats-it-all-mean&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;What’s it all mean&lt;/h2&gt;
&lt;p&gt;Not that yardage is ever perfect, but looking at yards and yards over expectation is tricky in football given the influence of outlying observations. This weakness is likely also the case with win probability added and, to a lesser extent, expected points. In place, comparing running back performance by matching the observed yards gained to an entire distribution of yards gained potentially provides deeper insight into running backs that over or underperform the opportunities in front of them. In addition to being able to put carries from much different settings into similar context, the percentiles appear more predictable, on a per-ball carrier basis, from one sample to the next.&lt;/p&gt;
&lt;p&gt;As one caveat to this analysis, Big Data Bowl projections include ball carrier speed and acceleration at handoff. If you consider those to be proxies for player skill, then there’s already some player characteristics baked into the projections. In other words, maybe the projections for Mostert’s touchdown run were really high because Mostert was running fast at handoff. If that’s the case (and as referenced by Sam et al &lt;a href=&#34;https://arxiv.org/abs/1906.01760&#34;&gt;here&lt;/a&gt;), a model designed for player evaluation would use player average speed/accelerations at handoff.&lt;/p&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>Plotting air yards</title>
      <link>/post/plotting-air-yards/</link>
      <pubDate>Thu, 19 Dec 2019 00:00:00 +0000</pubDate>
      
      <guid>/post/plotting-air-yards/</guid>
      <description>&lt;p&gt;Air yards plots are popular and informative ways for assessing the accuracy of quarterbacks at different depths of the field. As examples, &lt;a href=&#34;http://airyards.com/&#34;&gt;Josh&lt;/a&gt; and &lt;a href=&#34;https://twitter.com/benbbaldwin/status/1207369445720690690&#34;&gt;Ben&lt;/a&gt; have both done excellent work in highlighting how using where a quarterback was throwing to tells us more of a story than simply looking at completion percentage alone.&lt;/p&gt;
&lt;p&gt;Here’s one example of an air yards plot, using a pair of players from the 2019 season.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/post/2019-12-19-plotting-air-yards_files/figure-html/unnamed-chunk-2-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;The blue player tends to be slightly worse than the red player at short throws, better than than the red player at distances around 20 yards, and similar for longer distances. Both players are slightly worse than the league average for shorter throws, but better than the league average at longer throws.&lt;/p&gt;
&lt;p&gt;Can you guess who Players A and B are?&lt;/p&gt;
&lt;p&gt;Player A is Tom Brady in 2019.&lt;/p&gt;
&lt;p&gt;Player B is Tom Brady in 2019.&lt;/p&gt;
&lt;p&gt;How is that possible? Let’s dive a bit deeper into plots similar to these.&lt;/p&gt;
&lt;div id=&#34;air-yards-integer-distance&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Air yards ~ integer distance&lt;/h2&gt;
&lt;p&gt;One common approach for assessing the link between completion rate and air yards is to average completion percentage at each air yards integer. Then, with averages at each distance, we can plot those averages, and smooth out rough edges using a trend line.&lt;/p&gt;
&lt;p&gt;Here’s the example with Brady above.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/post/2019-12-19-plotting-air-yards_files/figure-html/unnamed-chunk-3-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Each of the dots in blue represent Brady’s completion rate at each of the yardage distances he has thrown to in 2019. You’ll notice higher variability in the dots after 30 yards – he doesn’t often throw that far, so averages at 0 or 1 will be more common.&lt;/p&gt;
&lt;p&gt;This traditional approach is usually sufficient at highlighting how quarterbacks perform.&lt;/p&gt;
&lt;p&gt;However, there are a few limitations.&lt;/p&gt;
&lt;ol style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;&lt;p&gt;The trend line corresponds to each dot. But each dot represents a different number of passes, something that the trend line doesn’t know.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Standard errors (if shown) reflect uncertainty in the trend line between the dots, not in the uncertainty in a quarterback’s completion percentage at a certain air yards.&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;div id=&#34;making-improvements&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Making improvements&lt;/h2&gt;
&lt;p&gt;There are several approaches that can leverage the number of passes at each air yards integer. I’ll use a generalized additive model (GAM), where a completion (Yes/No) is my outcome and air-yards is my explanatory variable. GAMs are attractive to measure the effect of any &lt;span class=&#34;math inline&#34;&gt;\(x\)&lt;/span&gt;-variable that might be related to &lt;span class=&#34;math inline&#34;&gt;\(y\)&lt;/span&gt; in a non-linear fashion, as they allow for a more flexible association. Additionally, GAMs include cross-validation by default to help prevent overfitting.&lt;/p&gt;
&lt;p&gt;Here’s what a GAM would look like for Brady (with calculations for uncertainty also shown).&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(mgcv)
### ay_all contains nflscrapr data from the 2017-19 seasons
ay_brady &amp;lt;- ay_all %&amp;gt;%
  filter(season == 2019, passer_player_name == &amp;quot;T.Brady&amp;quot;)

model_player_gam &amp;lt;- bam(complete_pass ~ s(air_yards), data = ay_brady,
                    method = &amp;quot;fREML&amp;quot;, discrete = TRUE, family = binomial(link=&amp;#39;logit&amp;#39;))
fit_predict &amp;lt;- expand.grid(air_yards = -10:50)
fit_predict$comp_logit = predict(model_player_gam, fit_predict)
fit_predict$comp_error = predict(model_player_gam, fit_predict, se = TRUE)$se.fit
fit_predict &amp;lt;- fit_predict %&amp;gt;%
  mutate(comp_hat = exp(comp_logit)/(1+exp(comp_logit)),
         comp_low = exp(comp_logit - 1.96*comp_error)/(1+exp(comp_logit - 1.96*comp_error)),
         comp_high = exp(comp_logit + 1.96*comp_error)/(1+exp(comp_logit + 1.96*comp_error)))

fit_predict %&amp;gt;%
  ggplot(aes(air_yards, comp_hat)) +
  geom_line(colour = &amp;quot;red&amp;quot;) +
  geom_ribbon(aes(ymin = comp_low, ymax = comp_high), fill = &amp;quot;red&amp;quot;, alpha = 0.3) +
  geom_smooth(data = ove_ave,
              aes(air_yards, y = ave_rate), colour = &amp;quot;grey70&amp;quot;, se = FALSE) +
  labs(title = &amp;quot;Completion % ~ Air yards, 2019&amp;quot;, y = &amp;quot;&amp;quot;, x = &amp;quot;Air yards&amp;quot;,
       subtitle = &amp;quot;Alternative method: model estimates (GAM)&amp;quot;) +
  annotate(x = 50, y = 0.31, &amp;quot;text&amp;quot;, label = expression(italic(&amp;quot;League Avg&amp;quot;)), colour = &amp;quot;grey70&amp;quot;) +
  theme_bw(13) +
  scale_y_continuous(labels = scales::percent)+
  scale_x_continuous(breaks = c(-10, 0, 10, 20, 30, 40, 50)) +
  coord_cartesian(ylim = c(0,1))&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2019-12-19-plotting-air-yards_files/figure-html/unnamed-chunk-5-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;When comparing the two versions, it’s less that one approach is better than the other, but more about what each plot is actually showing. My intuition is what we ultimately want out of each QBs trend line is an estimated completion percentage, and what we ultimately want out of error bars are an uncertainty around that estimate, which is why a model-based approach could be more attractive.&lt;/p&gt;
&lt;p&gt;Alternative models (logistic regressions with/without spline terms, hierarchical models, etc) could certainly work here as well.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;extrapolating&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Extrapolating&lt;/h2&gt;
&lt;p&gt;Brady is just one example, so I made a plot with all passers in 2019 who have made at least 300 attempts.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/post/2019-12-19-plotting-air-yards_files/figure-html/unnamed-chunk-6-1.png&#34; width=&#34;768&#34; /&gt;&lt;/p&gt;
&lt;p&gt;The dark blue-line corresponds to the traditional approach (averages by integer), while the dotted line represents estimates from a GAM (separate for each QB).&lt;/p&gt;
&lt;p&gt;As one graph to highlight, note the tail on Carson Wentz at low air-yards. Turns out, Wentz attempted 1 pass at -8 air yards, which fell incomplete, and no other passes at -7 air yards or less. Alternatively, he has 10 completions at 13 attempts between -6 and -5 air yards. A model-based approach is less likely to be sensitive to that one incompletion at -8 air yards.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;for-fun&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;For fun&lt;/h2&gt;
&lt;p&gt;Last Sunday night, Drew Brees entered the record books by completing 29 of his 30 passes. Among any quarterback with at least 20 attempts in one game, no player has posted a single-game completion percentage higher than Brees.&lt;/p&gt;
&lt;p&gt;It got me thinking about one thing that assuredly did not hurt Brees reach that mark – the game took place in the Mercedes-Benz Superdome.&lt;/p&gt;
&lt;p&gt;So, using a separate function for games played in the eight NFL stadia with domes, and one for games that are not played in domes, here’s how the air-yards curves compare. This uses data from 2017 through 2019.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/post/2019-12-19-plotting-air-yards_files/figure-html/unnamed-chunk-7-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;For what it’s worth, the QB closest to the non-dome line was Cam Newton, and the QB closest to the dome line was Dak Prescott (as assessed visually). It’s a fairly consistent difference of roughly 4 percentage points. A deeper look at domes would more appropriately account for the differences in QB abilities between dome and non-dome teams. Alternatively, a model showing only quarterbacks on away teams yielded similar results to the above. Either way, it is plausible that conditions played a small role in allowing Brees to reach such great heights.&lt;/p&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>R for NFL analysis</title>
      <link>/post/r-for-nfl-analysis/</link>
      <pubDate>Fri, 10 May 2019 00:00:00 +0000</pubDate>
      
      <guid>/post/r-for-nfl-analysis/</guid>
      <description>&lt;p&gt;As part of the NFL’s technology conference held last week, I presented to club staffers various approaches on how R could be used to explore NFL data. Here’s a slightly abridged version. This specific audience featured both novice and expert R users. Given that a semester’s long course would be needed to truly cover the breadth of how R could help explore football, note that this particular document is more an overview than anything else. Finally, most of the code is not meant to be run from an outsiders’ perspective, and instead uses a few internal databases. I’m sharing publicly in case it spurs any ideas for analysis or visualization.&lt;/p&gt;
&lt;div id=&#34;summary-of-session&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Summary of session&lt;/h2&gt;
&lt;ol style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;&lt;p&gt;Tidyverse and NFL analytics&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Sample visualizations using &lt;code&gt;ggplot2&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Big Data Bowl insight&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;div id=&#34;tidyverse-and-nfl-analytics&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Tidyverse and NFL analytics&lt;/h2&gt;
&lt;div id=&#34;packages&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Packages&lt;/h3&gt;
&lt;p&gt;Favorite packages to use for manipulation, tidying, data viz, analysis&lt;/p&gt;
&lt;ol style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;&lt;code&gt;tidyverse&lt;/code&gt; : Data manipulation and graphing&lt;/li&gt;
&lt;li&gt;&lt;code&gt;lubridate&lt;/code&gt; : Handling dates&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ggbeeswarm&lt;/code&gt; : Fun plots&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ggridges&lt;/code&gt; : Fun plots&lt;/li&gt;
&lt;li&gt;&lt;code&gt;gganimate&lt;/code&gt; : Fun animations&lt;/li&gt;
&lt;li&gt;&lt;code&gt;tidyr&lt;/code&gt; : Tidy data (wide to long/long to wide)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;nflscrapr&lt;/code&gt; : Public win probabilities and expected points&lt;/li&gt;
&lt;li&gt;&lt;code&gt;caret&lt;/code&gt; : Machine learning tools&lt;/li&gt;
&lt;li&gt;&lt;code&gt;lme4&lt;/code&gt; : Statistical modeling&lt;/li&gt;
&lt;li&gt;&lt;code&gt;teamcolors&lt;/code&gt;: Team specific hex codes&lt;/li&gt;
&lt;/ol&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;#install.packages(&amp;quot;tidyverse&amp;quot;)
library(tidyverse) 
library(lubridate) 
library(beeswarm)  
library(gganimate) 
library(ggridges)  
library(tidyr)     &lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;reading-in-data&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Reading in data&lt;/h3&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(tidyverse)
df_games &amp;lt;- read_csv(&amp;quot;prodb/dbo.Game.csv&amp;quot;)
df_plays &amp;lt;- read_csv(&amp;quot;prodb/dbo.VideoDirectorReport.csv&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;joining-data-sets&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Joining data sets&lt;/h3&gt;
&lt;p&gt;&lt;em&gt;Online cheat-sheet&lt;/em&gt;: &lt;a href=&#34;https://stat545.com/bit001_dplyr-cheatsheet.html&#34; class=&#34;uri&#34;&gt;https://stat545.com/bit001_dplyr-cheatsheet.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;left_join&lt;/code&gt;:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;inner_join&lt;/code&gt;:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;right_join&lt;/code&gt;:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;anti_join&lt;/code&gt;:&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;data-manipulation-using-the-tidyverse&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Data manipulation using the tidyverse&lt;/h3&gt;
&lt;p&gt;&lt;em&gt;Online cheat-sheet&lt;/em&gt;: &lt;a href=&#34;https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf&#34; class=&#34;uri&#34;&gt;https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Key commands:&lt;/p&gt;
&lt;ol style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;select()&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;head()&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;tail()&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;filter()&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;df_plays_keep &amp;lt;- df_plays %&amp;gt;% 
  filter(HomeTeamFile == 1) %&amp;gt;% 
  select(GameKey, HomeClubCode, VisitorClubCode, Quarter, 
        PossessionTeam, PlayNullifiedByPenalty, 
        SpecialTeamsPlayType, PlayResult, Down, Distance, PlayDescription)
df_games &amp;lt;- df_games %&amp;gt;% select(GameKey, Season, Season_Type, Week, LeagueType)

df_plays_keep &amp;lt;- df_plays_keep %&amp;gt;% left_join(df_games, by = c(&amp;quot;GameKey&amp;quot; = &amp;quot;GameKey&amp;quot;))
df_plays_keep %&amp;gt;% head()&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 6 x 15
##   GameKey HomeClubCode VisitorClubCode Quarter PossessionTeam
##     &amp;lt;int&amp;gt; &amp;lt;chr&amp;gt;        &amp;lt;chr&amp;gt;             &amp;lt;int&amp;gt; &amp;lt;chr&amp;gt;         
## 1     745 TEN          PIT                   2 TEN           
## 2     745 TEN          PIT                   2 TEN           
## 3     745 TEN          PIT                   4 PIT           
## 4     745 TEN          PIT                   4 PIT           
## 5     745 TEN          PIT                   4 PIT           
## 6     745 TEN          PIT                   4 PIT           
## # … with 10 more variables: PlayNullifiedByPenalty &amp;lt;chr&amp;gt;,
## #   SpecialTeamsPlayType &amp;lt;chr&amp;gt;, PlayResult &amp;lt;int&amp;gt;, Down &amp;lt;int&amp;gt;,
## #   Distance &amp;lt;int&amp;gt;, PlayDescription &amp;lt;chr&amp;gt;, Season &amp;lt;int&amp;gt;,
## #   Season_Type &amp;lt;chr&amp;gt;, Week &amp;lt;int&amp;gt;, LeagueType &amp;lt;chr&amp;gt;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;df_plays_keep %&amp;gt;% tail()&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 6 x 15
##   GameKey HomeClubCode VisitorClubCode Quarter PossessionTeam
##     &amp;lt;int&amp;gt; &amp;lt;chr&amp;gt;        &amp;lt;chr&amp;gt;             &amp;lt;int&amp;gt; &amp;lt;chr&amp;gt;         
## 1   57464 NE           BUF                   3 BUF           
## 2   57469 SF           JAX                   2 JAX           
## 3   57466 NYJ          LAC                   1 LAC           
## 4   57462 CIN          DET                   4 DET           
## 5   57442 IND          DEN                   4 DEN           
## 6   57467 TEN          LA                    4 LA            
## # … with 10 more variables: PlayNullifiedByPenalty &amp;lt;chr&amp;gt;,
## #   SpecialTeamsPlayType &amp;lt;chr&amp;gt;, PlayResult &amp;lt;int&amp;gt;, Down &amp;lt;int&amp;gt;,
## #   Distance &amp;lt;int&amp;gt;, PlayDescription &amp;lt;chr&amp;gt;, Season &amp;lt;int&amp;gt;,
## #   Season_Type &amp;lt;chr&amp;gt;, Week &amp;lt;int&amp;gt;, LeagueType &amp;lt;chr&amp;gt;&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;4&#34; style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;More &lt;code&gt;filter()&lt;/code&gt;: Categorical variables&lt;/li&gt;
&lt;/ol&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;df_plays_keep %&amp;gt;% 
  filter(Down == 4, Quarter == 1, Distance == 12, 
         PlayNullifiedByPenalty == &amp;quot;N&amp;quot;, SpecialTeamsPlayType == &amp;quot;NULL&amp;quot;) &lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 4 x 15
##   GameKey HomeClubCode VisitorClubCode Quarter PossessionTeam
##     &amp;lt;int&amp;gt; &amp;lt;chr&amp;gt;        &amp;lt;chr&amp;gt;             &amp;lt;int&amp;gt; &amp;lt;chr&amp;gt;         
## 1   26558 NE           BUF                   1 BUF           
## 2   29406 CLV          BUF                   1 BUF           
## 3   54993 CIN          NO                    1 CIN           
## 4   29772 GB           DET                   1 GB            
## # … with 10 more variables: PlayNullifiedByPenalty &amp;lt;chr&amp;gt;,
## #   SpecialTeamsPlayType &amp;lt;chr&amp;gt;, PlayResult &amp;lt;int&amp;gt;, Down &amp;lt;int&amp;gt;,
## #   Distance &amp;lt;int&amp;gt;, PlayDescription &amp;lt;chr&amp;gt;, Season &amp;lt;int&amp;gt;,
## #   Season_Type &amp;lt;chr&amp;gt;, Week &amp;lt;int&amp;gt;, LeagueType &amp;lt;chr&amp;gt;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;df_plays_keep &amp;lt;- df_plays_keep  %&amp;gt;% 
  filter(Season_Type == &amp;quot;Reg&amp;quot;, Season &amp;gt;= 2005, Season &amp;lt;= 2018, LeagueType == &amp;quot;NFL&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;What data set did we create?&lt;/strong&gt;&lt;/p&gt;
&lt;ol start=&#34;5&#34; style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;&lt;code&gt;arrange()&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;df_plays_keep %&amp;gt;% 
  filter(PossessionTeam == &amp;quot;MIN&amp;quot;, Season == 2018) %&amp;gt;% 
  arrange(-PlayResult) %&amp;gt;% 
  head()&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 6 x 15
##   GameKey HomeClubCode VisitorClubCode Quarter PossessionTeam
##     &amp;lt;int&amp;gt; &amp;lt;chr&amp;gt;        &amp;lt;chr&amp;gt;             &amp;lt;int&amp;gt; &amp;lt;chr&amp;gt;         
## 1   57812 MIN          CHI                   2 MIN           
## 2   57586 GB           MIN                   4 MIN           
## 3   57607 MIN          BUF                   2 MIN           
## 4   57694 MIN          DET                   2 MIN           
## 5   57640 PHI          MIN                   3 MIN           
## 6   57668 NYJ          MIN                   3 MIN           
## # … with 10 more variables: PlayNullifiedByPenalty &amp;lt;chr&amp;gt;,
## #   SpecialTeamsPlayType &amp;lt;chr&amp;gt;, PlayResult &amp;lt;int&amp;gt;, Down &amp;lt;int&amp;gt;,
## #   Distance &amp;lt;int&amp;gt;, PlayDescription &amp;lt;chr&amp;gt;, Season &amp;lt;int&amp;gt;,
## #   Season_Type &amp;lt;chr&amp;gt;, Week &amp;lt;int&amp;gt;, LeagueType &amp;lt;chr&amp;gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;What plays are these?&lt;/strong&gt;?&lt;/p&gt;
&lt;ol start=&#34;6&#34; style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;&lt;code&gt;mutate()&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;df_plays_keep &amp;lt;- df_plays_keep %&amp;gt;% 
  mutate(is_first_down = PlayResult &amp;gt;= Distance, 
         scrimmage_play = SpecialTeamsPlayType == &amp;quot;NULL&amp;quot;)

df_plays_keep %&amp;gt;% 
  filter(PossessionTeam == &amp;quot;MIN&amp;quot;, Season == 2018, Down == 4, scrimmage_play, Quarter == 1) &lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 4 x 17
##   GameKey HomeClubCode VisitorClubCode Quarter PossessionTeam
##     &amp;lt;int&amp;gt; &amp;lt;chr&amp;gt;        &amp;lt;chr&amp;gt;             &amp;lt;int&amp;gt; &amp;lt;chr&amp;gt;         
## 1   57694 MIN          DET                   1 MIN           
## 2   57686 MIN          NO                    1 MIN           
## 3   57741 MIN          GB                    1 MIN           
## 4   57651 MIN          ARZ                   1 MIN           
## # … with 12 more variables: PlayNullifiedByPenalty &amp;lt;chr&amp;gt;,
## #   SpecialTeamsPlayType &amp;lt;chr&amp;gt;, PlayResult &amp;lt;int&amp;gt;, Down &amp;lt;int&amp;gt;,
## #   Distance &amp;lt;int&amp;gt;, PlayDescription &amp;lt;chr&amp;gt;, Season &amp;lt;int&amp;gt;,
## #   Season_Type &amp;lt;chr&amp;gt;, Week &amp;lt;int&amp;gt;, LeagueType &amp;lt;chr&amp;gt;, is_first_down &amp;lt;lgl&amp;gt;,
## #   scrimmage_play &amp;lt;lgl&amp;gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;What do these four plays represent?&lt;/strong&gt;&lt;/p&gt;
&lt;ol start=&#34;7&#34; style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;group_by()&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;summarize()&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;df_plays_keep %&amp;gt;% 
  filter(scrimmage_play, Season == 2018) %&amp;gt;% 
  group_by(PossessionTeam) %&amp;gt;% 
  summarise(ave_yds_gained = mean(PlayResult)) %&amp;gt;% 
  arrange(-ave_yds_gained) %&amp;gt;% 
  head()&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 6 x 2
##   PossessionTeam ave_yds_gained
##   &amp;lt;chr&amp;gt;                   &amp;lt;dbl&amp;gt;
## 1 KC                       6.25
## 2 LA                       6.04
## 3 ATL                      5.78
## 4 PIT                      5.76
## 5 TB                       5.70
## 6 LAC                      5.67&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;Identify the leaderboard above&lt;/strong&gt;:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;df_plays_keep %&amp;gt;% 
  filter(scrimmage_play) %&amp;gt;% 
  group_by(PossessionTeam, Season) %&amp;gt;% 
  summarise(ave_yds_gained = mean(PlayResult)) %&amp;gt;% 
  arrange(-ave_yds_gained) %&amp;gt;% 
  head()&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 6 x 3
## # Groups:   PossessionTeam [6]
##   PossessionTeam Season ave_yds_gained
##   &amp;lt;chr&amp;gt;           &amp;lt;int&amp;gt;          &amp;lt;dbl&amp;gt;
## 1 ATL              2016           6.29
## 2 NO               2011           6.26
## 3 KC               2018           6.25
## 4 GB               2011           6.08
## 5 LA               2018           6.04
## 6 ARZ              2015           5.96&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;Identify the leaderboard above&lt;/strong&gt;:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;df_plays_keep %&amp;gt;% 
  filter(scrimmage_play) %&amp;gt;% 
  group_by(PossessionTeam, Season) %&amp;gt;% 
  summarise(ave_yds_gained = mean(PlayResult)) %&amp;gt;% 
  arrange(-ave_yds_gained) %&amp;gt;% 
  tail()&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 6 x 3
## # Groups:   PossessionTeam [5]
##   PossessionTeam Season ave_yds_gained
##   &amp;lt;chr&amp;gt;           &amp;lt;int&amp;gt;          &amp;lt;dbl&amp;gt;
## 1 HST              2005           3.81
## 2 CIN              2008           3.80
## 3 ARZ              2012           3.74
## 4 SF               2005           3.61
## 5 SF               2007           3.59
## 6 OAK              2006           3.50&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;Identify the leaderboard above&lt;/strong&gt;:&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&#34;data-visualization&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Data visualization&lt;/h2&gt;
&lt;div id=&#34;sample-q1-how-often-do-teams-go-for-it-on-4th-short-in-each-season&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Sample Q1: How often do teams go for it on 4th-short in each season?&lt;/h3&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;fourth_down_rates &amp;lt;- df_plays_keep %&amp;gt;% 
  filter(Down == 4, Distance &amp;lt;= 2) %&amp;gt;% 
  group_by(PossessionTeam, Season) %&amp;gt;% 
  summarise(go_forit_rate = mean(scrimmage_play), 
            n_chances = n())


fourth_down_rates %&amp;gt;% 
  arrange(-go_forit_rate) %&amp;gt;% 
  head()&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 6 x 4
## # Groups:   PossessionTeam [6]
##   PossessionTeam Season go_forit_rate n_chances
##   &amp;lt;chr&amp;gt;           &amp;lt;int&amp;gt;         &amp;lt;dbl&amp;gt;     &amp;lt;int&amp;gt;
## 1 JAX              2013         0.692        26
## 2 BUF              2018         0.688        16
## 3 NE               2007         0.682        22
## 4 CLV              2017         0.667        15
## 5 MIN              2018         0.654        26
## 6 BLT              2018         0.65         20&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;fourth_down_rates %&amp;gt;% 
  arrange(go_forit_rate) %&amp;gt;% 
  head()&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 6 x 4
## # Groups:   PossessionTeam [6]
##   PossessionTeam Season go_forit_rate n_chances
##   &amp;lt;chr&amp;gt;           &amp;lt;int&amp;gt;         &amp;lt;dbl&amp;gt;     &amp;lt;int&amp;gt;
## 1 BUF              2012        0.05          20
## 2 CIN              2007        0.0526        19
## 3 SL               2015        0.0588        17
## 4 CAR              2006        0.0714        28
## 5 ATL              2012        0.0938        32
## 6 MIN              2005        0.1           30&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(ggbeeswarm)
fourth_down_rates %&amp;gt;% 
  ggplot(aes(x = Season, y = go_forit_rate, fill = go_forit_rate)) + 
  geom_quasirandom(pch = 21, size = 3) + 
  scale_fill_viridis_c(&amp;quot;&amp;quot;,  guide = FALSE) + 
  theme_classic(15) +  
  scale_x_continuous(labels = 2005:2018, breaks = 2005:2018) + 
  scale_y_continuous(labels = scales::percent) + 
  labs(title = &amp;quot;Go-for-it rate, 4th-1 or 4th-2&amp;quot;, y = &amp;quot;&amp;quot;, x = &amp;quot;&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2019-05-10-r-for-nfl-analysis_files/figure-html/unnamed-chunk-11-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;sample-q2-whats-going-on-on-the-punt-play&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Sample Q2: What’s going on on the punt play?&lt;/h3&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;df_punts_keep &amp;lt;- df_plays %&amp;gt;% 
  filter(HomeTeamFile == 1, SpecialTeamsPlayType == &amp;quot;Punt&amp;quot;|SpecialTeamsPlayType == &amp;quot;Punt Return&amp;quot;) %&amp;gt;% 
  select(GameKey, HomeClubCode, VisitorClubCode, Quarter, KickoffResult,
        PossessionTeam, PlayNullifiedByPenalty, 
        SpecialTeamsPlayType, PlayResult, Down, Distance, PlayDescription)

df_punts_keep &amp;lt;- df_punts_keep %&amp;gt;% left_join(df_games, by = c(&amp;quot;GameKey&amp;quot; = &amp;quot;GameKey&amp;quot;))

## Penalty rate on punt plays using `grepl`
df_punts_keep %&amp;gt;% 
  mutate(is_penalty = grepl(&amp;quot;PENALTY&amp;quot;, PlayDescription)) %&amp;gt;% 
  summarise(p_rate = mean(is_penalty))&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 1 x 1
##   p_rate
##    &amp;lt;dbl&amp;gt;
## 1  0.138&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;df_punts_keep %&amp;gt;% 
  filter(Season &amp;gt;= 2001) %&amp;gt;% 
  ggplot(aes(Season, fill = KickoffResult)) + 
  geom_bar(position = &amp;quot;fill&amp;quot;) + 
  scale_fill_brewer(palette = &amp;quot;Set1&amp;quot;) + 
  scale_y_continuous(labels = scales::percent, &amp;quot;Rate&amp;quot;) + 
  labs(title = &amp;quot;Punt outcomes over time&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2019-05-10-r-for-nfl-analysis_files/figure-html/unnamed-chunk-12-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;other-charts-of-interest&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Other charts of interest&lt;/h3&gt;
&lt;div id=&#34;examples-from-league-office&#34; class=&#34;section level4&#34;&gt;
&lt;h4&gt;Examples from league office&lt;/h4&gt;
&lt;ol style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;Tyler Lockett funnel plot&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/statsbylopez/mlopez/master/public/img/lockett.png&#34; width=&#34;550px&#34; /&gt;&lt;/p&gt;
&lt;ol start=&#34;2&#34; style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;Maps&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/statsbylopez/mlopez/master/public/img/hex_college.PNG&#34; width=&#34;550px&#34; /&gt;&lt;/p&gt;
&lt;ol start=&#34;3&#34; style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;Team logos with &lt;code&gt;ggimage&lt;/code&gt;: &lt;a href=&#34;https://statsbylopez.netlify.com/post/nfl-team-logos-using-ggimage/&#34;&gt;link&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/statsbylopez/mlopez/master/public/img/ggimage.png&#34; width=&#34;550px&#34; /&gt;&lt;/p&gt;
&lt;ol start=&#34;4&#34; style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;Competition committee work: resampling plays to estimate overtime outcomes&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/statsbylopez/mlopez/master/public/img/drive_sim.PNG&#34; width=&#34;650px&#34; /&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&#34;what-can-we-do-with-next-gen-stats&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;What can we do with Next Gen Stats?&lt;/h3&gt;
&lt;p&gt;General processes for NGS data&lt;/p&gt;
&lt;ol style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;Start small. Identify play-type of interest and find 5-10 examples using &lt;code&gt;playId&lt;/code&gt;/&lt;code&gt;gameId&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Scrape data using &lt;a href=&#34;https://docs.ngs.nfl.com&#34; class=&#34;uri&#34;&gt;https://docs.ngs.nfl.com&lt;/a&gt; and personal credentials&lt;/li&gt;
&lt;li&gt;Build animation/summary metrics within the sample of plays&lt;/li&gt;
&lt;li&gt;Re-center data using &lt;code&gt;playDirection&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Re-orgin data using location where (player/ball) started&lt;/li&gt;
&lt;li&gt;Cross-check with video&lt;/li&gt;
&lt;li&gt;Expand across larger sample of plays&lt;/li&gt;
&lt;li&gt;Sample large sample of plays to cross-check for accuracy&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;div id=&#34;play-animation&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Play animation&lt;/h3&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;file_tracking &amp;lt;- &amp;quot;https://raw.githubusercontent.com/nfl-football-ops/Big-Data-Bowl/master/Data/tracking_gameId_2017090700.csv&amp;quot;
tracking_example &amp;lt;- read_csv(file_tracking)

file_game &amp;lt;- &amp;quot;https://raw.githubusercontent.com/nfl-football-ops/Big-Data-Bowl/master/Data/games.csv&amp;quot;
games_sum &amp;lt;- read_csv(file_game) 

file_plays &amp;lt;- &amp;quot;https://raw.githubusercontent.com/nfl-football-ops/Big-Data-Bowl/master/Data/plays.csv&amp;quot;
plays_sum &amp;lt;- read_csv(file_plays) 

tracking_example_merged &amp;lt;- tracking_example %&amp;gt;% inner_join(games_sum) %&amp;gt;% inner_join(plays_sum) 

example_play &amp;lt;- tracking_example_merged %&amp;gt;% filter(playId == 938)
example_play %&amp;gt;% select(playDescription) %&amp;gt;% slice(1)

library(gganimate)
library(cowplot)

## General field boundaries
xmin &amp;lt;- 0
xmax &amp;lt;- 160/3
hash.right &amp;lt;- 38.35
hash.left &amp;lt;- 12
hash.width &amp;lt;- 3.3


## Specific boundaries for a given play
ymin &amp;lt;- max(round(min(example_play$x, na.rm = TRUE) - 10, -1), 0)
ymax &amp;lt;- min(round(max(example_play$x, na.rm = TRUE) + 10, -1), 120)
df_hash &amp;lt;- expand.grid(x = c(0, 23.36667, 29.96667, xmax), y = (10:110))
df_hash &amp;lt;- df_hash %&amp;gt;% filter(!(floor(y %% 5) == 0))
df_hash &amp;lt;- df_hash %&amp;gt;% filter(y &amp;lt; ymax, y &amp;gt; ymin)

animate_play &amp;lt;- ggplot() +
  scale_size_manual(values = c(6, 4, 6), guide = FALSE) + 
  scale_shape_manual(values = c(21, 16, 21), guide = FALSE) +
  scale_fill_manual(values = c(&amp;quot;#e31837&amp;quot;, &amp;quot;#654321&amp;quot;, &amp;quot;#002244&amp;quot;), guide = FALSE) + 
  scale_colour_manual(values = c(&amp;quot;black&amp;quot;, &amp;quot;#654321&amp;quot;, &amp;quot;#c60c30&amp;quot;), guide = FALSE) + 
  annotate(&amp;quot;text&amp;quot;, x = df_hash$x[df_hash$x &amp;lt; 55/2], 
           y = df_hash$y[df_hash$x &amp;lt; 55/2], label = &amp;quot;_&amp;quot;, hjust = 0, vjust = -0.2) + 
  annotate(&amp;quot;text&amp;quot;, x = df_hash$x[df_hash$x &amp;gt; 55/2], 
           y = df_hash$y[df_hash$x &amp;gt; 55/2], label = &amp;quot;_&amp;quot;, hjust = 1, vjust = -0.2) + 
  annotate(&amp;quot;segment&amp;quot;, x = xmin, 
           y = seq(max(10, ymin), min(ymax, 110), by = 5), 
           xend =  xmax, 
           yend = seq(max(10, ymin), min(ymax, 110), by = 5)) + 
  annotate(&amp;quot;text&amp;quot;, x = rep(hash.left, 11), y = seq(10, 110, by = 10), 
                    label = c(&amp;quot;G   &amp;quot;, seq(10, 50, by = 10), rev(seq(10, 40, by = 10)), &amp;quot;   G&amp;quot;), 
                    angle = 270, size = 4) + 
  annotate(&amp;quot;text&amp;quot;, x = rep((xmax - hash.left), 11), y = seq(10, 110, by = 10), 
           label = c(&amp;quot;   G&amp;quot;, seq(10, 50, by = 10), rev(seq(10, 40, by = 10)), &amp;quot;G   &amp;quot;), 
           angle = 90, size = 4) + 
  annotate(&amp;quot;segment&amp;quot;, x = c(xmin, xmin, xmax, xmax), 
           y = c(ymin, ymax, ymax, ymin), 
           xend = c(xmin, xmax, xmax, xmin), 
           yend = c(ymax, ymax, ymin, ymin), colour = &amp;quot;black&amp;quot;) + 
  geom_point(data = example_play, aes(x = (xmax-y), y = x, shape = team,
                                 fill = team, group = nflId, size = team, colour = team), alpha = 0.7) + 
  geom_text(data = example_play, aes(x = (xmax-y), y = x, label = jerseyNumber), colour = &amp;quot;white&amp;quot;, 
            vjust = 0.36, size = 3.5) + 
  ylim(ymin, ymax) + 
  coord_fixed() +  
  theme_nothing() + 
  transition_time(frame.id)  +
  ease_aes(&amp;#39;linear&amp;#39;) + 
  NULL

## Ensure timing of play matches 10 frames-per-second
play.length.ex &amp;lt;- length(unique(example.play$frame.id))
#animate(animate.play, fps = 10, nframe = play.length.ex)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/statsbylopez/mlopez/master/public/img/kc_ne.gif&#34; width=&#34;500px&#34; /&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;target-maps&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Target maps&lt;/h3&gt;
&lt;p&gt;&lt;em&gt;Shiny app built in R&lt;/em&gt;: &lt;a href=&#34;https://www.cmusportsanalytics.com/introduction-to-next-gen-scrapy/&#34; class=&#34;uri&#34;&gt;https://www.cmusportsanalytics.com/introduction-to-next-gen-scrapy/&lt;/a&gt;, &lt;a href=&#34;https://sarahmallepalle.shinyapps.io/next-gen-scrapy/&#34; class=&#34;uri&#34;&gt;https://sarahmallepalle.shinyapps.io/next-gen-scrapy/&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;win-probability&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Win probability&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/statsbylopez/mlopez/master/public/img/no_pit.gif&#34; width=&#34;500px&#34; /&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;spray-chartsqb-paths&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Spray charts/qb paths&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/statsbylopez/mlopez/master/public/img/passes_mahomes.gif&#34; width=&#34;500px&#34; /&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;rb-locations&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;RB locations&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/statsbylopez/mlopez/master/public/img/bell.PNG&#34; width=&#34;500px&#34; /&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&#34;big-data-bowl&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Big Data Bowl&lt;/h2&gt;
&lt;div id=&#34;background&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Background&lt;/h3&gt;
&lt;ol style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;&lt;p&gt;Football Ops website with rules and winners: &lt;a href=&#34;https://operations.nfl.com/the-game/big-data-bowl/&#34; class=&#34;uri&#34;&gt;https://operations.nfl.com/the-game/big-data-bowl/&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;(Static) Github page that hosted the data: &lt;a href=&#34;https://github.com/nfl-football-ops/Big-Data-Bowl&#34; class=&#34;uri&#34;&gt;https://github.com/nfl-football-ops/Big-Data-Bowl&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Forthcoming link: each submission, linked with participants and select resumes&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;div id=&#34;sample-entries-and-code&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Sample entries and code:&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Kyle Burris:&lt;a href=&#34;https://github.com/burrisk/Big-Data-Bowl&#34; class=&#34;uri&#34;&gt;https://github.com/burrisk/Big-Data-Bowl&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/statsbylopez/mlopez/master/public/img/burris.gif&#34; width=&#34;400px&#34; /&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;SFU college:&lt;a href=&#34;https://operations.nfl.com/media/3670/big-data-bowl-sfu.pdf&#34; class=&#34;uri&#34;&gt;https://operations.nfl.com/media/3670/big-data-bowl-sfu.pdf&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/statsbylopez/mlopez/master/public/img/sfu.PNG&#34; width=&#34;600px&#34; /&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>Estimating NFL drive outcomes under rules that don&#39;t exist</title>
      <link>/post/resampling-nfl-drives/</link>
      <pubDate>Mon, 06 May 2019 00:00:00 +0000</pubDate>
      
      <guid>/post/resampling-nfl-drives/</guid>
      <description>&lt;p&gt;&lt;strong&gt;How do you estimate outcomes under a set of rules that don’t (yet) exist?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;In this post, I’ll walk through how the NFL league office used resampling to estimate metrics related to an offseason proposal related to overtime.&lt;/p&gt;
&lt;div id=&#34;background&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Background&lt;/h2&gt;
&lt;p&gt;Back in March, the NFL’s competition committee and owners debated the merits of a rule change, proposed by &lt;a href=&#34;https://operations.nfl.com/updates/football-ops/2019-playing-rules-proposals/&#34;&gt;Kansas City&lt;/a&gt;, that would allow both teams the opportunity to possess the ball at least one time in overtime. This would create a scenario unlike any other in football. If the game starts with an opening drive touchdown, the receiving team would:&lt;/p&gt;
&lt;ol style=&#34;list-style-type: lower-roman&#34;&gt;
&lt;li&gt;Need a touchdown to extend the game&lt;/li&gt;
&lt;li&gt;Never punt&lt;/li&gt;
&lt;li&gt;Never attempt a field goal&lt;/li&gt;
&lt;li&gt;Not care much about the clock&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Points (ii) and (iii) are key. It is not uncommon for teams to need a touchdown when trailing late, but in those situations, a number of other factors also play a role in decision making, including timeouts, team quality, and game clock.&lt;/p&gt;
&lt;p&gt;In overtime, meanwhile, a team needing a touchdown would never punt or kick a field goal. &lt;em&gt;So how often would they score a touchdown?&lt;/em&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;resampling-plays&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Resampling plays&lt;/h2&gt;
&lt;p&gt;We’ll need more granular data than drive outcomes to estimate touchdown likelihood. So, let’s use plays.&lt;/p&gt;
&lt;p&gt;One possibility would be to estimate a conditional distribution of play outcomes given down, distance, and field position. That is, given play-level characteristics, estimate the likelihood of gaining certain yardage on the next play. Using that, one could build a drive simulator.&lt;/p&gt;
&lt;p&gt;But football’s not that easy. Once you modeled yardage gained, you’d realize you should have started with modeling turnover likelihood. Once you model turnover likelihood, you’d realize you should have started with penalty likelihood. And once you modeled penalty likelihood, you’d realize you should have built a model to estimate where the drive would start in the first place. Basically, a statistics version of &lt;a href=&#34;https://en.wikipedia.org/wiki/If_You_Give_a_Mouse_a_Cookie&#34;&gt;“If you give a mouse a cookie”&lt;/a&gt;. You could also model a joint distribution here, but, at this point, that’s an area for future work.&lt;/p&gt;
&lt;p&gt;In absence of building several such models, a second, simpler approach would use the observed set of plays and some resampling. That is, at each down, distance, and yard line, we’ll sample from the empirical distribution of similar plays to simulate a play that could happen.&lt;/p&gt;
&lt;p&gt;Here’s a version of what this looks. Given that our internal data is a slightly more enhanced than what’s out there publicly, for this post I modified our code to accomodate the public play-by-play data from &lt;a href=&#34;https://github.com/maksimhorowitz/nflscrapR&#34;&gt;nflscrapr&lt;/a&gt;. Each of these plays are stored in a data frame &lt;code&gt;scrapr.plays&lt;/code&gt;, grabbed using code &lt;a href=&#34;https://github.com/statsbylopez/BlogPosts/blob/master/scrapr-data.R&#34;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;div id=&#34;pre-processing&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Pre-processing&lt;/h3&gt;
&lt;p&gt;First, to ensure team motivations roughly fall in line with those participating in an overtime game, I’ll strip the entire set of NFL plays into scrimmage plays run in one possession games, outside of the last two minutes of each half. I also drop two-point conversions, create indicator for whether a fumble or interception occured (&lt;code&gt;is.turnover&lt;/code&gt;), whether an offensive (&lt;code&gt;is.td.offense&lt;/code&gt;) touchdown occured, and add a variable for line-of-scrimmage (yards from own goal, or &lt;code&gt;yfog&lt;/code&gt;).&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(tidyverse)
scrapr.plays &amp;lt;- read_csv(&amp;quot;scrapr_plays.csv&amp;quot;)

df.scrimmage &amp;lt;- scrapr.plays %&amp;gt;% 
  filter(play_type == &amp;quot;pass&amp;quot;|play_type == &amp;quot;run&amp;quot;, half_seconds_remaining &amp;gt;= 120) %&amp;gt;% 
  mutate(p.diff = total_home_score - total_away_score, 
         is.two.point = grepl(&amp;quot;TWO-POINT CONVERSION&amp;quot;, desc), 
         is.fumble = !is.na(fumble_recovery_1_team), 
         is.turnover = grepl(&amp;quot;INTERCEPTED&amp;quot;, desc)|(is.fumble &amp;amp; fumble_recovery_1_team!=posteam), 
         is.td.offense = rush_touchdown|pass_touchdown, 
         yfog = 100 - yardline_100) %&amp;gt;% 
  filter(abs(p.diff) &amp;lt;= 8, !is.two.point, 
         !is.na(yards_gained))&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;sampling-plays&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Sampling plays&lt;/h3&gt;
&lt;p&gt;Next, I write a function, &lt;code&gt;sample.rp.drive.needs.TD&lt;/code&gt;, to sample &lt;code&gt;df.scrimmage&lt;/code&gt; based on down, distance, and line of scrimmage. The code for that is &lt;a href=&#34;https://github.com/statsbylopez/BlogPosts/blob/master/scrapr-data.R&#34;&gt;here&lt;/a&gt;. Given that 1st-10 plays from midfield are similar to 1st-10 plays from, say, the 47-yard line, the sampling process gives a bit of wiggle room around yard line to increase the number of plays available at each down and distance. In this example, I use +/- 3 yards, +/- 2 yards, +/- 1 yard, and 0 yards for (1-70), (71-90), (91-97), and (98-99) yards-from-own-goal intervals, respectively. I don’t want to add three yards when a team has 3rd-goal from the one, but I’m okay sampling a 3rd-5 play from the 40 yard-line when a team is actually at the 42. To allow for larger samples of plays, 4th-down plays are treated as 3rd-downs.&lt;/p&gt;
&lt;p&gt;As an example, here’s the type of outcome you’d get from the function above. On one 1st-10, Mitchell Trubisky hits Taylor Gabriel for a 54-yard catch! On the next, Joe Flacco is picked off by Steve Gregory.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;sample.play &amp;lt;- sample.rp.drive.needs.TD(down = 1, yards.to.go = 10, yards.from.own.goal = 25)
sample.play$play&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] (7:50) (Shotgun) M.Trubisky pass deep left to T.Gabriel to MIA 21 for 54 yards (T.McTyer).
## Levels: (7:50) (Shotgun) M.Trubisky pass deep left to T.Gabriel to MIA 21 for 54 yards (T.McTyer).&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;sample.play &amp;lt;- sample.rp.drive.needs.TD(down = 1, yards.to.go = 10, yards.from.own.goal = 25)
sample.play$play&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] (7:42) J.Flacco pass deep middle intended for D.Pitta INTERCEPTED by S.Gregory at BAL 42. S.Gregory to BAL 6 for 36 yards (R.Rice).
## Levels: (7:42) J.Flacco pass deep middle intended for D.Pitta INTERCEPTED by S.Gregory at BAL 42. S.Gregory to BAL 6 for 36 yards (R.Rice).&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;sampling-entire-drives&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Sampling entire drives&lt;/h3&gt;
&lt;p&gt;We’ll want to iteratively build out drives, so that after each play, the offensive team continues to try and move down the field. After Gabriel’s catch above, for example, the offense would have 1st-10 from the opponent 21-yard line. Note that for simplicity in this post, I’ll assume each drive started at a team’s 25-yard line – in overtime, roughly 70% of drives start here.&lt;/p&gt;
&lt;p&gt;The key part of the loop below is the &lt;code&gt;while()&lt;/code&gt; command: we continue to sample plays until (i) a turnover (ii) an offensive touchdown or (iii) a team goes for it on 4th-down and fails, any of which would formally signal the end of the drive (&lt;code&gt;end.of.drive&lt;/code&gt;).&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;set.seed(0)
all.drives.store &amp;lt;- NULL
n.sim &amp;lt;- 10000
yfog.start &amp;lt;- 25
for (i in 1:n.sim){
  drive.store &amp;lt;- NULL
  new.down &amp;lt;- 1
  new.distance &amp;lt;- 10
  new.yfog &amp;lt;- yfog.start
  end.of.drive &amp;lt;- FALSE
  play.num &amp;lt;- 1
  while (!end.of.drive){
    run.play &amp;lt;- sample.rp.drive.needs.TD(down = new.down, 
                                         yards.to.go = new.distance, 
                                         yards.from.own.goal = new.yfog)
    run.play$play.num &amp;lt;- play.num
    drive.store &amp;lt;- bind_rows(drive.store, run.play)
    new.down &amp;lt;- run.play$new.down
    new.distance &amp;lt;- run.play$new.distance
    new.yfog &amp;lt;- run.play$new.yfog
    end.of.drive &amp;lt;- run.play$end.drive
    play.num &amp;lt;- play.num + 1
    drive.store
  }
  i &amp;lt;- i + 1
  drive.store$sim.id &amp;lt;- i
  drive.store
  
  if (i %% 100 == 0){print(i)}
  all.drives.store &amp;lt;- bind_rows(all.drives.store, drive.store)
}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;what-a-simulated-drive-looks-like&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;What a simulated drive looks like&lt;/h3&gt;
&lt;p&gt;Here’s one sampled drive. It starts with an Andy Dalton pass on 1st-10, and ends a few plays later with a long pass to Dez Bryant. Keep in mind that this &lt;em&gt;should&lt;/em&gt; look weird – we’re sampling plays across the last decade of play, and will jump back and forth between offenses.
&lt;img src=&#34;/post/2019-05-06-resampling-nfl-drives_files/figure-html/unnamed-chunk-6-1.png&#34; width=&#34;768&#34; /&gt;&lt;/p&gt;
&lt;p&gt;More importantly, this particular drive shows the importance of replicating what &lt;strong&gt;could&lt;/strong&gt; happen in overtime. Above, the offense went for it on 4th-2 in its own territory, a Mike Gillislee run that is shown in red. In a typical game, most teams in this situation would have punted the ball away. By being forced to be aggressive, what was otherwise a likely punt became a touchdown.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;aggregating-across-drives&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Aggregating across drives&lt;/h3&gt;
&lt;p&gt;So, how often would an offense score a touchdown in overtime? Here’s a plot of drive outcomes. Each of the 10,000 simulations is a dot, and about 3 of every 10 dots signify an offensive touchdown. In other words, when needing a touchdown and a touchdown only, an offense will score on about 30% of its drives.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/post/2019-05-06-resampling-nfl-drives_files/figure-html/unnamed-chunk-7-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;How’s this compare to non-overtime drives? Well, teams score a touchdown on the first drive of overtime about 20% of the time, which is roughly what matches the first drive of the &lt;a href=&#34;https://twitter.com/StatsbyLopez/status/1118236788974342146&#34;&gt;game&lt;/a&gt;. In other words, the &lt;em&gt;need&lt;/em&gt; to score a touchdown increases a team’s chance of scoring that touchdown by about a factor of 1.5.&lt;/p&gt;
&lt;p&gt;But wait, there’s more.&lt;/p&gt;
&lt;p&gt;The above simulation dodges a few things that complicate football drives, most notably penalties. In our work at the league office, we got a number closer to 40% than 30%. That is, when you add in penalties, which tend to help the offense more than they help the defense, you’ll likely get a rate higher than the 30% I got above. Additionally, changes to the game (recently, more passing) and potential changes in third-down behavior (perhaps teams would run more if they know they are going to go for it?) are two weaknesses that jump out in the above approach.&lt;/p&gt;
&lt;p&gt;For now, however, hopefully this gives you a sense of how resampling helped project rules in NFL games that don’t exist. In our case, we sampled from the empirical distribution of actual plays to simulate an offense moving down the field in overtime. Given the forced aggressiveness, we identified a touchdown scoring rate that we could use to better assess what could happen under a rules proposal that would change how NFL overtimes work.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>In an NHL game, the next penalty is easier to predict than the next goal</title>
      <link>/post/next-nhl-event/</link>
      <pubDate>Fri, 19 Apr 2019 00:00:00 +0000</pubDate>
      
      <guid>/post/next-nhl-event/</guid>
      <description>&lt;p&gt;It&amp;rsquo;s NHL playoff season, which means that, given the relative &lt;a href=&#34;https://arxiv.org/abs/1701.05976&#34; target=&#34;_blank&#34;&gt;league parity&lt;/a&gt;, every call and no-call comes under a microscope. In the third period of close games, for example, a penalty call alone can decrease a team&amp;rsquo;s chance of winning by &lt;a href=&#34;http://moneypuck.com/g.htm?id=2018030174&#34; target=&#34;_blank&#34;&gt;10 percentage points&lt;/a&gt; or more.&lt;/p&gt;

&lt;p&gt;One characteristic of NHL games that a few prominent members of the media &lt;a href=&#34;https://twitter.com/domluszczyszyn/status/1116450841022488576&#34; target=&#34;_blank&#34;&gt;have picked up on&lt;/a&gt; is that penalty calls tend to &amp;ldquo;even-up&amp;rdquo; within a game &amp;ndash; that is, it is unlikely that either team ends the game with a substantially larger number of penalties than its opponent. &lt;a href=&#34;https://papers.ssrn.com/sol3/papers.cfm?abstract_id=2259798&#34; target=&#34;_blank&#34;&gt;Kevin and I&lt;/a&gt;, as well as a few others (&lt;a href=&#34;http://people.stat.sfu.ca/~tim/papers/penalty.pdf&#34; target=&#34;_blank&#34;&gt;ex 1&lt;/a&gt;, &lt;a href=&#34;https://www.researchgate.net/publication/274325288_Reversal_of_Fortune_A_Statistical_Analysis_of_Penalty_Calls_in_the_National_Hockey_League&#34; target=&#34;_blank&#34;&gt;ex 2&lt;/a&gt;), have covered this in depth over the last few years.&lt;/p&gt;

&lt;p&gt;But a fun comparison I thought to make would be that, instead of the analyzing the impact of penalty differential alone, let&amp;rsquo;s compare penalty likelihood to goal likelihood. That is, given goal and penalty information from earlier in the game, compare the chance that the next goal is scored by the home team to the chance that the next penalty is called on the home team.&lt;/p&gt;

&lt;p&gt;Using all games from 2005-2016, here&amp;rsquo;s the likelihood that (i) the first penalty of the second period is called on the home team (left plot) and (ii) the first goal of the second period is scored by the home team (right plot), given both the goal and penalty differentials in the first period. Goal and penalty differentials are given relative to the home team.&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;/img/nhlpens.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Two aspects stand out.&lt;/p&gt;

&lt;p&gt;First, the rates shown in the penalty plot are both more extreme and show more consistent of a pattern than in the goal plot. If you want to predict the first penalty of the second period, that&amp;rsquo;s likely an easier task than predicting the first goal. Second, many of the differences in the goal plot are driven not by goal differential, but by penalty differential. In the goal plot, the pattern looking left to right seems stronger than the pattern looking bottom to top. Thinking more broadly, we&amp;rsquo;ve long known that score effects impact NHL team behavior &amp;ndash; I wonder if part of this is due to the fact that score effects are somewhat of a proxy for penalty differential.&lt;/p&gt;

&lt;p&gt;Technical postscripts:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;I stopped after the 2016 only because I don&amp;rsquo;t have a clean pbp data-set to match the &lt;a href=&#34;https://cran.r-project.org/src/contrib/Archive/nhlscrapr/&#34; target=&#34;_blank&#34;&gt;nhlscrapR&lt;/a&gt; version I used before. If anyone wants to update, I&amp;rsquo;d be curious to see the results. A comparison of regular and postseason games could also be warranted.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;A smart observer would point out that one could improve a goal prediction model by including characteristics of each team, whereas including those same factors is unlikely to have as much of an impact on a penalty prediction model. Perhaps a future post.&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
</description>
    </item>
    
    <item>
      <title>NFL team logos using ggimage</title>
      <link>/post/nfl-team-logos-using-ggimage/</link>
      <pubDate>Thu, 25 Oct 2018 00:00:00 +0000</pubDate>
      
      <guid>/post/nfl-team-logos-using-ggimage/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://twitter.com/bburkeESPN/status/1055150920340774912&#34;&gt;Brian&lt;/a&gt;, &lt;a href=&#34;https://twitter.com/abresler/status/1055446174730240000&#34;&gt;Alex&lt;/a&gt;, and a host of others have done nice work recently when it comes to creating better scatter plots using images in &lt;code&gt;ggplot&lt;/code&gt; in &lt;a href=&#34;https://cran.r-project.org/&#34;&gt;R&lt;/a&gt;. In this post, I’ll show how easy it is to use the &lt;code&gt;ggimage&lt;/code&gt; package and do the same.&lt;/p&gt;
&lt;div id=&#34;what-data-to-use&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;What data to use?&lt;/h2&gt;
&lt;p&gt;Ron, Sam, Max, and the folks at &lt;a href=&#34;https://github.com/maksimhorowitz/nflscrapR&#34;&gt;nflscrapR&lt;/a&gt; have built a pretty amazing tool to analyze football play-by-play data. They’ve nicely stored csv’s that summarize several play-level and team-level characteristics relating to each play. In my example, I’ll use this data to contrast team run and pass performance, as measured through expected points added. For more on expected points, see Trey’s series &lt;a href=&#34;http://thespread.us/expected-points.html&#34;&gt;here&lt;/a&gt;, or the nfl WAR paper &lt;a href=&#34;https://arxiv.org/abs/1802.00998&#34;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;First, we read in the data, and create what would be a typical plot that highlights run and pass performance for each offense.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(RCurl)
library(tidyverse)
library(ggrepel)
url.18 &amp;lt;- getURL(&amp;quot;https://raw.githubusercontent.com/ryurko/nflscrapR-data/master/play_by_play_data/regular_season/reg_pbp_2018.csv&amp;quot;)
pbp &amp;lt;- read.csv(text = url.18)
scrimmage.plays &amp;lt;- pbp %&amp;gt;% filter(play_type == &amp;quot;pass&amp;quot;|play_type == &amp;quot;run&amp;quot;)
scrimmage.plays.summary &amp;lt;- scrimmage.plays %&amp;gt;% 
  group_by(posteam, play_type) %&amp;gt;% 
  summarise(ave.epa = mean(epa, na.rm = TRUE)) %&amp;gt;%
  spread(play_type, ave.epa)

bound.label &amp;lt;- 0.38
df.text &amp;lt;- data.frame(lab.text = c(&amp;quot;Run +, Pass -&amp;quot;, &amp;quot;Run +, Pass +&amp;quot;, &amp;quot;Run -, Pass +&amp;quot;, &amp;quot;Run -, Pass -&amp;quot;), 
                      x = c(bound.label, bound.label, -1*bound.label, -1*bound.label), 
                      y = c(-1*bound.label, bound.label, bound.label, -1*bound.label))

ggplot(scrimmage.plays.summary, aes(run, pass, label = posteam)) + 
  geom_point() + 
  geom_text_repel() + 
  xlab(&amp;quot;Run: average offensive EPA&amp;quot;) + 
  ylab(&amp;quot;Pass: average offensive EPA&amp;quot;) + 
  theme_minimal() + 
  labs(title = &amp;quot;Offensive performance, 2018 season&amp;quot;, subtitle = &amp;quot;Data courtesy: nflscrapR&amp;quot;) + 
  geom_hline(aes(yintercept = 0), lty = 2, col = &amp;quot;red&amp;quot;, alpha = 0.5)+ 
  geom_vline(aes(xintercept = 0), lty = 2, col = &amp;quot;red&amp;quot;, alpha = 0.5) + 
  xlim(c(-0.45, 0.45)) + ylim(c(-0.45, 0.45)) + 
  geom_text(data = df.text, aes(x, y, label = lab.text), colour = &amp;quot;red&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2018-10-25-nfl-team-logos-using-ggimage_files/figure-html/unnamed-chunk-1-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;There’s a bunch that can be gleamed from the chart above. As one example, the team-to-team variability in average pass EPA is greater than that of the team-to-team variability in average rush EPA. As another, 23 of 32 teams boast a greater-than-0 average pass EPA, compared to 14 of 32 teams that have an average rush EPA greater than 0. This doesn’t exactly mean teams should pass more – averages are impacted by skewness, and the distribution of play-level EPA on passes is strongly skewed right.&lt;/p&gt;
&lt;p&gt;None of these findings are particularly new, however, and to date, there is a large amount of literature regarding the run versus pass debate. In fact, there’s someone who has probably already made the exact graph above.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;adding-in-team-logos&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Adding in team logos&lt;/h2&gt;
&lt;p&gt;It’s perhaps more visually appealing to use team logos (or helmets) in place of three letter team codes. For ages, adding images to &lt;code&gt;ggplot&lt;/code&gt; R graphs required the use of several lines of code: using the &lt;code&gt;ggimage&lt;/code&gt; package, that process is (fortunately) no longer needed.&lt;/p&gt;
&lt;p&gt;In the code below, I link to a file (eventually stored as &lt;code&gt;df.logos&lt;/code&gt;) that has up-to-date NFL logos (drawn via Wikipedia png’s), and merge with the data above.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(ggimage)
url.logo &amp;lt;- getURL(&amp;quot;https://raw.githubusercontent.com/statsbylopez/BlogPosts/master/nfl_teamlogos.csv&amp;quot;)
df.logos &amp;lt;- read.csv(text = url.logo)
scrimmage.plays.summary &amp;lt;- scrimmage.plays.summary %&amp;gt;% 
  left_join(df.logos, by = c(&amp;quot;posteam&amp;quot; = &amp;quot;team_code&amp;quot;))

ggplot(scrimmage.plays.summary, aes(run, pass)) + 
  geom_image(aes(image = url), size = 0.05) + 
  xlab(&amp;quot;Run: average offensive EPA&amp;quot;) + 
  ylab(&amp;quot;Pass: average offensive EPA&amp;quot;) + 
  theme_minimal() + 
  labs(title = &amp;quot;Offensive performance, 2018 season&amp;quot;, subtitle = &amp;quot;Data courtesy: nflscrapR&amp;quot;) + 
  geom_hline(aes(yintercept = 0), lty = 2, col = &amp;quot;red&amp;quot;, alpha = 0.5)+ 
  geom_vline(aes(xintercept = 0), lty = 2, col = &amp;quot;red&amp;quot;, alpha = 0.5) + 
  xlim(c(-0.45, 0.45)) + ylim(c(-0.45, 0.45)) + 
  geom_text(data = df.text, aes(x, y, label = lab.text), colour = &amp;quot;red&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2018-10-25-nfl-team-logos-using-ggimage_files/figure-html/unnamed-chunk-2-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Same chart as we initially had, and one-less line of code. The key command is &lt;code&gt;geom_image&lt;/code&gt;, which functions similar to &lt;code&gt;geom_point&lt;/code&gt; but requires a url to draw an image from.&lt;/p&gt;
&lt;p&gt;Feel free to use the logo file in similar fashion – and I hope you do! Graphs with logos often look better than their text counterparts. One next step will be to jitter team-logos to prevent overlap, but that’s for another day.&lt;/p&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>Lessons hidden in sports betting markets</title>
      <link>/post/lessons-hidden-in-sports-betting-markets/</link>
      <pubDate>Wed, 22 Aug 2018 00:00:00 +0000</pubDate>
      
      <guid>/post/lessons-hidden-in-sports-betting-markets/</guid>
      <description>&lt;p&gt;With sports betting now legal in several US states, I might as well give away my number one piece of advice for amateurs looking to gamble:&lt;/p&gt;

&lt;p&gt;Don&amp;rsquo;t bet.&lt;/p&gt;

&lt;p&gt;It&amp;rsquo;s an easy recommendation. Numbers implied by betting markets are too good, too close to the truth that, when accounting for the vig, it&amp;rsquo;s nearly impossible to make a long term profit.&lt;/p&gt;

&lt;p&gt;But just because your local statistician tells you not to bet doesn&amp;rsquo;t mean you shouldn&amp;rsquo;t check out betting market odds. In fact, it&amp;rsquo;s just the opposite. There&amp;rsquo;s no single piece of public information that is more accurate and informative with respect to a professional sports game than the closing odds.  Related: there is no better standard with which sports scientists can compare prediction models than to compare to betting odds.&lt;/p&gt;

&lt;p&gt;In a recent paper, &lt;a href=&#34;http://www.science.smith.edu/~bbaumer/w/&#34; target=&#34;_blank&#34;&gt;Ben&lt;/a&gt;, &lt;a href=&#34;https://statsinthewild.com/&#34; target=&#34;_blank&#34;&gt;Greg&lt;/a&gt;, and I took a deep dive to learn about what betting odds tell us about the four major North American pro sports leagues, the NBA, NHL, NFL, and MLB (sorry, MLS, but three-way odds are a different story). It&amp;rsquo;s titled &amp;ldquo;How often does the best team win? A unified approach to understanding randomness in North American sport,&amp;rdquo; but our alternate title might as well be &amp;ldquo;Betting markets: if you can&amp;rsquo;t beat em, use them in a statistical model.&amp;rdquo; I&amp;rsquo;d welcome readers to check out a pre-print of the &lt;a href=&#34;https://arxiv.org/abs/1701.05976&#34; target=&#34;_blank&#34;&gt;manuscipt&lt;/a&gt;, forthcoming in &lt;a href=&#34;https://www.imstat.org/journals-and-publications/annals-of-applied-statistics/&#34; target=&#34;_blank&#34;&gt;Annals of Applied Statistics&lt;/a&gt;, if they are interested in more details. As the paper&amp;rsquo;s focus more on the technical side, what&amp;rsquo;s missing is a cohesive summary of what it all means. In other words, how can we use our results &amp;ndash; built using betting market data &amp;ndash; to make better decisions in sports?&lt;/p&gt;

&lt;p&gt;I&amp;rsquo;ll provide several ideas in the following set of posts.&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Part I: &lt;a href=&#34;http://statsbylopez.netlify.com/post/part-i-randomness-of-games/&#34; target=&#34;_blank&#34;&gt;Why I feel bad for Max Scherzer (on the game-level randomness in sports)&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Part II: &lt;a href=&#34;http://statsbylopez.netlify.com/post/part-ii-randomness-of-series/&#34; target=&#34;_blank&#34;&gt;Rethinking our playoff philosophy (on the role of chance in the postseason)&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Part III: &lt;a href=&#34;http://statsbylopez.netlify.com/post/playing-at-home/&#34; target=&#34;_blank&#34;&gt;Rocky Mountain High (The benefit of playing at home)&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Part IV: &lt;a href=&#34;http://statsbylopez.netlify.com/post/part-iv-schedule-strength/&#34; target=&#34;_blank&#34;&gt;Why the Orioles should have traded Manny Machado to the Dodgers for a spot in the NL West (on schedule strength)&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Hopefully you&amp;rsquo;ll be able to use these posts to learn a bit of insight into how each sports leagues compare to one another, and how various factors can play a major role in team success.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Note: this series of post is based off of a forthcoming academic paper and does not reflect views of my current employer (the NFL).&lt;/em&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Part I: Why I feel bad for Max Scherzer (on the game-level randomness in sports)</title>
      <link>/post/part-i-randomness-of-games/</link>
      <pubDate>Wed, 22 Aug 2018 00:00:00 +0000</pubDate>
      
      <guid>/post/part-i-randomness-of-games/</guid>
      <description>&lt;p&gt;The best team in baseball during the 2013 season was the Detroit Tigers.&lt;/p&gt;

&lt;p&gt;Detroit&amp;rsquo;s rotation featured the eventual Cy Young award winner (Max Scherzer), alongside both the 2011 and 2016 Cy winners (Justin Verlander and Rick Porcello, respectively). The Tigers line-up was spearheaded by Prince Fielder and Miguel Cabrera, the latter of whom would win his second consecutive MVP. Indeed, betting market rankings had the Tigers atop the sport &lt;a href=&#34;https://statsbylopez.github.io/NESSIS2017_files/NESSIS_2017.html#section-2&#34; target=&#34;_blank&#34;&gt;for basically the entire season&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;But on October 19th of that year, the best team in baseball was fighting to save its season. The Tigers trailed the Boston Red Sox three games to two in Game 6 the American League Championship series, with each of Detroit&amp;rsquo;s three losses coming by exactly one run. Needing a win to force a game 7, Scherzer gave the Tigers a bit of hope, in the form of a 2-1 lead as the teams went to the bottom of the 7th inning.&lt;/p&gt;

&lt;p&gt;It&amp;rsquo;s at that point in the game that the best team in baseball was also its unluckiest.&lt;/p&gt;

&lt;p&gt;It started with a runner on second, one out, and Xander Bogaerts at the plate. With a full count, Scherzer threw a pitch that umpires almost always call a strike 3.&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;/post/2018-08-22-part-i-randomness-of-regular-season-competition_files/xander.gif&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;But instead of strike 3, home plate umpire Dan Iassogna called the pitch ball 4. And so instead of a runner on 2nd and two outs, the Red Sox now had two runners on and out out. Iassogna&amp;rsquo;s decision &amp;ndash; one umpires only call a ball about 1 in 7 times &amp;ndash; dropped the Tigers&amp;rsquo; win expectency by about 12 percentage points.&lt;/p&gt;

&lt;p&gt;Next, Detroit reliever Drew Smily induced a chopper up the middle off the bat of Jacoby Ellsbury, hit in the direction of shortstop Jose Iglesias. It&amp;rsquo;s the type of play Iglesias often starts a double play on. Worst case for the Tigers, one would think, he&amp;rsquo;d record only one out.&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;/post/2018-08-22-part-i-randomness-of-regular-season-competition_files/jose.gif&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;But Iglesias bumbled the ball, recording no outs and leaving the bases loaded. Allowing for one out on the play, the error was worth about a 20 perentage point drop in win expectency for Detroit.&lt;/p&gt;

&lt;p&gt;Scherzer and the Tigers should&amp;rsquo;ve been out of the inning but for a few bad breaks. But they weren&amp;rsquo;t, which allowed Shane Victorino to step to the plate with the bases loaded. Victorino&amp;rsquo;s at-bat involved a little less luck; he hit a grand slam, and the Tigers season was effectively over.&lt;/p&gt;

&lt;p&gt;The Tigers&amp;rsquo; final game was heartbreaking, and indicative of one of the most humbling aspects of being a sports fan: the better team doesn&amp;rsquo;t always win, even when it may deserve to. It happened for the Tigers in 2013, but it happens for all teams in all seasons and in almost all sports. Sometimes it&amp;rsquo;s factors that are completely outside of a the better teams control &amp;ndash; a referee call, a bad bounce, poor conditions, or, like the Tigers, a missed strike three. Or sometimes the better team just plays poorly &amp;ndash; missing open three-pointers, field goals, saves, or, like the Tigers, easy ground balls up the middle. Or sometimes the &amp;ldquo;better&amp;rdquo; team might simply be so close in terms of talent to the &amp;ldquo;worse&amp;rdquo; team, that any number of plays, shots, or referee decisions could play into the game&amp;rsquo;s outcome, actions that, by and large, are noise and not indicative of any particular skill or talent. However it happens, being the better team doesn&amp;rsquo;t exactly equate to always being the team with more runs, goals, or points.&lt;/p&gt;

&lt;p&gt;When Greg, Ben and I set out to compare North American sports, our principal goal was to consider how often, in each sport, the better team ended up winning. Here&amp;rsquo;s our main take-home, which summarizes the game-level randomness of each league.&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;/post/2018-08-22-part-i-randomness-of-regular-season-competition_files/parity2.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;On the far left, the NHL and MLB games cluster closer to coin flips; that is, if we were to randomly take a game between two randomly drawn teams, it&amp;rsquo;s less likely that the best team will win. As referenced above, part of this is luck &amp;ndash; one can surmise that given the low amounts of scoring involved in baseball and hockey, more breaks are needed to win &amp;ndash; but a related part of it is also because the best teams in the MLB and in the NHL can still lose to the worse teams and fans wouldn&amp;rsquo;t be &lt;em&gt;that&lt;/em&gt; surprised. The gaps in talent in those leagues are, at least relatively, not as wide.&lt;/p&gt;

&lt;p&gt;Alternatively, the NFL and NBA roughly live in a world halfway between coin-flips and pre-determined outcomes.&lt;/p&gt;

&lt;p&gt;Our findings are somewhat unique. There&amp;rsquo;s a whole literature on competitive balance that&amp;rsquo;s out there, with which we are only in partial agreement. For example, though tempting, answering a question like ours &lt;a href=&#34;https://www.vox.com/videos/2017/6/5/15740632/luck-skill-sports&#34; target=&#34;_blank&#34;&gt;can&amp;rsquo;t be done using win percentages&lt;/a&gt;, because win percentages are effected by things like schedule strength and number of games.&lt;/p&gt;

&lt;p&gt;But more importantly, our findings highlight the immense power of betting market data which, when combined with a statistical modeling framework that can account for changes to team strength, allows us to capture league-level and team-level traits that have, to-date, mostly been unknown.&lt;/p&gt;

&lt;p&gt;Indeed, Scherzer&amp;rsquo;s bad break is but one anecdote behind several ways in which our work can inform decision makers and fans alike. Here&amp;rsquo;s a list of several take-homes that come with a better understanding of the randomness of sporting outcomes.&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;Luck (or just generally uncertainty) plays an enormous role in MLB and NHL outcomes. The worse team can beat the better team. Sometimes, shit just happens.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Looking at standings to determine how good each team is? Stop &amp;ndash; you can do better. Our betting market metrics of how good each team is are better predictors of future won-loss percentage than current won-loss percentage is. In other words, if you look at the standings, and I look at betting market data, I&amp;rsquo;ll have more accurate predictions of how the rest of the season will shake out than you will (and I don&amp;rsquo;t even need to know win percentages to make that claim).&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Afraid of our modeling? Use Mike Beuey&amp;rsquo;s ratings at &lt;a href=&#34;http://www.inpredictable.com/&#34; target=&#34;_blank&#34;&gt;Inpredictable&lt;/a&gt;. Bookmark his site. Market ratings like this are more on point than just about any public metric out there, and certainly better than standings or most power rankings. The data&amp;rsquo;s that good. If you want to know how good a team is, check to see when it&amp;rsquo;s a favorite or when it&amp;rsquo;s an underdog.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Here are a few specific ways that decision-makers could use betting market information.&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Is your team going to make the playoffs? Start with betting market data, estimate probabilities for each game and each team, simulate the rest of the season, and find out.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Should you trade for a certain player?  Here&amp;rsquo;s an easy, back-of-the-envelope way to estimate how valuable a player is: compare how betting odds stack up when this player is and isn&amp;rsquo;t in the lineup.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;What are your chances of winning a title if you do make the playoffs? Simulate the postseason. Don&amp;rsquo;t be surprised if your team doesn&amp;rsquo;t win, even if it&amp;rsquo;s the best team (hint: I&amp;rsquo;ll do this in my next post)&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Altogether, the traditional mechanism by which we evaluate teams — wins and losses - can belie characteristics that are vital to understanding team strength. Turns out, NHL and MLB outcomes are closer to 50-50 calls than those in the NFL and NBA, and the difference between those two pairs of leagues is fairly large.  For fans, and perhaps Max Scherzer, hopefully this provides a modicum of comfort when your favorite team falls short.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Note: This is Part I in a set of posts of how betting markets can inform sports fans. To return to the series homepage, click &lt;a href=&#34;http://statsbylopez.netlify.com/post/lessons-hidden-in-sports-betting-markets/&#34; target=&#34;_blank&#34;&gt;here&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Part II: Rethinking our playoff philosophy (on the role of chance in the postseason)</title>
      <link>/post/part-ii-randomness-of-series/</link>
      <pubDate>Wed, 22 Aug 2018 00:00:00 +0000</pubDate>
      
      <guid>/post/part-ii-randomness-of-series/</guid>
      <description>

&lt;p&gt;In the 2016-17 season, the Washington Capitals &lt;a href=&#34;https://www.washingtonpost.com/news/fancy-stats/wp/2017/02/09/this-is-the-most-dominating-washington-capitals-team-ever-so-whats-it-mean-for-the-cup/?noredirect=on&amp;amp;utm_term=.940cf4c44b8f&#34; target=&#34;_blank&#34;&gt;dominated&lt;/a&gt; the NHL like few teams in recent history, winning the Presidents&amp;rsquo; Trophy with 118 points.&lt;/p&gt;

&lt;p&gt;The Caps entered a 2nd-round playoff series with Pittsburgh as decent-sized favorites (58 percent), and sure enough, Washington outplayed its rivals. In each of seven consecutive games, the Capitals outshot the Penguins, finishing with 70 total more shots on goal.&lt;/p&gt;

&lt;p&gt;Unfortunately for Washington, not enough shots turned into goals, and because hockey games are decided by goals, it was the Penguins that moved onto the Eastern Conference Finals. The Caps were sent home, with the early exit enough to drive NBC commentator Mike Milbury to the brink.&lt;/p&gt;

&lt;p&gt;&amp;ldquo;They have to rethink their whole philosophy,&amp;rdquo; Milbury &lt;a href=&#34;https://twitter.com/StatsbyLopez/status/862503623565205504&#34; target=&#34;_blank&#34;&gt;suggested&lt;/a&gt; after the game.&lt;/p&gt;

&lt;p&gt;I probably don&amp;rsquo;t need to tell you what happened next. The Caps made a few changes to their roster &amp;ndash; call it a reconsidered philosophy &amp;ndash; enough so that by this year&amp;rsquo;s 2nd-round, they were the &lt;a href=&#34;https://twitter.com/StatsbyLopez/status/990611488401510401&#34; target=&#34;_blank&#34;&gt;least likely&lt;/a&gt; team among the eight remaining to raise a Stanley Cup. Despite those odds, Washington won its first title.&lt;/p&gt;

&lt;p&gt;&amp;ldquo;This Capitals team doesn’t have better talent than years past, but they have better focus and attitudes,&amp;rdquo; Milbury argued.&lt;/p&gt;

&lt;p&gt;Washington&amp;rsquo;s rise to the top of the NHL illustrates that, in hockey&amp;rsquo;s postseason, surprising things can happen. In the rest of this post, I opine on what should and shouldn&amp;rsquo;t be surprising in playoff competition, using the NHL, NBA, NFL, and MLB.&lt;/p&gt;

&lt;h2 id=&#34;when-does-the-better-team-win-in-the-postseason&#34;&gt;When does the better team win in the postseason?&lt;/h2&gt;

&lt;p&gt;Let&amp;rsquo;s start with some trivia.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Two NBA playoff teams from the last decade are drawn at random and play one another in a &amp;ldquo;best-of-7&amp;rdquo; series &amp;ndash; what is the probability that the better team wins out?&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Turns out, it&amp;rsquo;s about 80%. In other words, the best NBA team advances, on average, in roughly four of five series.&lt;/p&gt;

&lt;p&gt;That&amp;rsquo;s a pretty high number &amp;ndash; how does it compare to other sports?&lt;/p&gt;

&lt;p&gt;Given what we&amp;rsquo;ve learned in previous &lt;a href=&#34;http://statsbylopez.netlify.com/post/part-i-randomness-of-games/&#34; target=&#34;_blank&#34;&gt;posts&lt;/a&gt;, it&amp;rsquo;s no shock to find out that both the NHL and MLB hover just above 60% in &amp;ldquo;best-of-7&amp;rdquo; formats, which is notably lower. However, let&amp;rsquo;s switch that question just a bit:&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;How long would postseason series need to be in NFL, MLB and NHL to match the NBA&amp;rsquo;s &amp;ldquo;better team advances&amp;rdquo; rate of 80%?&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Here&amp;rsquo;s what &lt;a href=&#34;https://arxiv.org/abs/1701.05976&#34; target=&#34;_blank&#34;&gt;Ben, Greg, and I found&lt;/a&gt;.&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;In the NFL, a &amp;ldquo;best-of-11&amp;rdquo; series is needed to match the NBA&amp;rsquo;s better team advances rate.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;In the NHL, a &amp;ldquo;best-of-51&amp;rdquo; series is needed to match the NBA&amp;rsquo;s better team advances rate.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;And in MLB, an astounding &amp;ldquo;best-of-75&amp;rdquo; series is needed to match the NBA&amp;rsquo;s better team advances rate.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;That is, if we wanted postseason formats to be equivalent across leagues, we&amp;rsquo;d need the NHL and MLB to do complete, and obviously ludicrous, overhauls.&lt;/p&gt;

&lt;h2 id=&#34;how-can-we-compare-one-postseason-format-to-another&#34;&gt;How can we compare one postseason format to another?&lt;/h2&gt;

&lt;p&gt;The NFL&amp;rsquo;s never going to use a &amp;ldquo;best-of-7&amp;rdquo; format, nor is MLB going to use a &amp;ldquo;best-of-75&amp;rdquo; format.&lt;/p&gt;

&lt;p&gt;Instead, to better contrast each league, &lt;a href=&#34;https://arxiv.org/abs/1701.05976&#34; target=&#34;_blank&#34;&gt;Greg, Ben and I&lt;/a&gt; derived a general metric that takes existing postseason formats (number of teams, rounds, games in each round, etc), mixed in our measurements of team strength, and identified how closely each league aligned with a completely deterministic model where the best team &lt;em&gt;always&lt;/em&gt; advanced and won a title.&lt;/p&gt;

&lt;p&gt;Here&amp;rsquo;s a plot that summarizes the equivalence of current postseason formats in each of the MLB, NFL, NHL, and NBA. Tournaments where the better team always advanced would score on the far right, while tournaments where every franchise had an equal chance in each round would show up on the far left.&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;/post/2018-08-22-part-i-randomness-of-regular-season-competition_files/parity.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Unsurprisingly, the NBA stands out.* Better NBA teams more often advance, and the best NBA team more often wins out.&lt;/p&gt;

&lt;p&gt;Interestingly, the NHL, MLB, and NFL all somewhat overlap. In other words, each league&amp;rsquo;s postseason structure roughly does a similar job of allowing better teams to advance.&lt;/p&gt;

&lt;h2 id=&#34;so-what-s-this-all-mean&#34;&gt;So what&amp;rsquo;s this all mean?&lt;/h2&gt;

&lt;p&gt;Well, here&amp;rsquo;s where the list gets long.&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;The best team doesn&amp;rsquo;t always win in the postseason in any sport. However, the best team is substantially more likely to win in the NBA than in any of the other three leagues.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Compared to our &lt;a href=&#34;http://statsbylopez.netlify.com/post/part-i-randomness-of-games/&#34; target=&#34;_blank&#34;&gt;regular season findings&lt;/a&gt;, the NFL is less aligned with the NBA in the figure above. However, there&amp;rsquo;s an easy explanation &amp;ndash; the NFL&amp;rsquo;s single elimination playoff format. Single elimination tournaments add noise &amp;ndash; it&amp;rsquo;s why the NCAA hoops tournament is called March Madness, after all &amp;ndash; which decrease the chances that better teams advance. It&amp;rsquo;s why the NFL frequently has champs that seem to come from nowhere, including the 2001 Patriots, 2007 Giants, and 2011 Ravens. In such instances, we shouldn&amp;rsquo;t be surprised when NFL teams that seem like surprises win out. It&amp;rsquo;s what happens in single elimination formats.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Another subtle difference in the NFL: it&amp;rsquo;s the only league where a team is generally not given home advantage in the title game/series. One of the best sports teams of all time &amp;ndash; the 2007 Patriots &amp;ndash; lost to the Giants on a neutral field in a one-game Super Bowl. Imagine the 2018 Warriors playing the Cavs for an NBA title in a one-game series in, say, Indianapolis? Yes, that&amp;rsquo;d be incredible theater. But it&amp;rsquo;d be incredible theater for the same reason that March Madness games are often incredible theater. The Warriors would be favored, but the Cavs&amp;rsquo; chances in such a set-up would increase by several orders of magnitude, relative to the current NBA format.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;From a team&amp;rsquo;s standpoint, understanding the inherent randomness of postseason outcomes is critical. Some examples:&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Last seed into the NHL, NFL, or MLB playoffs? You still have a chance. And that&amp;rsquo;s worth playing hard for, because, in all likelihood, having the worst chance is still actually a reasonable chance.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Last seed in the NBA playoffs? Your work is cut out for you.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Win a title? Congrats! Now check if you are one of the best teams. If you are, even better. But if you aren&amp;rsquo;t the best team &amp;ndash; say, you are the 2013 Red Sox, which won after &lt;a href=&#34;https://statsbylopez.github.io/NESSIS2017_files/NESSIS_2017.html#how-often-does-the-best-team-win&#34; target=&#34;_blank&#34;&gt;getting every break in the book&lt;/a&gt; against a more talented Tigers team &amp;ndash; don&amp;rsquo;t simply bring back all of your players and think that lightning will strike twice. It usually doesn&amp;rsquo;t &amp;ndash; the 2014 Red Sox, with largely the same pieces as in 2013, finished in last place in the American League East.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Fail to win a title? Here&amp;rsquo;s where an understanding postseason tournament formats is most critical. If you are one of the top teams, do your best to keep going. Convince folks internally how talented and skilled your team actually was. Don&amp;rsquo;t be afraid to point out things like randomness and luck (or to show them this article). And don&amp;rsquo;t do things like &amp;ldquo;rethink your whole philosophy.&amp;rdquo; Though, in fairness, &amp;ldquo;don&amp;rsquo;t do things that Mike Milbury says to do&amp;rdquo; shouldn&amp;rsquo;t need so much math.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Consider tweaks to current playoff formats. The NBA begins its playoffs with a &amp;ldquo;best-of-7&amp;rdquo; series between No. 1 and No. 8 seeds. Sweeps in these matchups are often more likely than &lt;em&gt;any&lt;/em&gt; wins from the No. 8 seed. Meanwhile, MLB starts with a one-game play-in game and a &amp;ldquo;best-of-5&amp;rdquo; series between a No. 1 seed and roughly the equivalent of a No. 4 seed. In some years, however, MLB&amp;rsquo;s No. 4 seed may be nearly as good as its No. 1 (that may happen this year with the Yankees). Altogether, MLB and NHL postseason formats don&amp;rsquo;t do enough to reward good teams, while the NBA arguably does too much.**&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Stop the all-consuming allocation of credit and skill to teams that win titles and to teams that win titles alone. This is particularly biting in the NFL, MLB and NHL, where a fumble recovery, third strike call, or crossbar can make a difference between winning a ring and not winning one.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Conversely, labeling once-in-a-generation players as chokers isn&amp;rsquo;t quite appropriate, particularly in sports where it&amp;rsquo;s tougher to win in the postseason. See this from &lt;a href=&#34;https://www.rollingstone.com/culture/culture-lists/10-biggest-chokers-in-sports-history-108696/alexander-ovechkin-109184/&#34; target=&#34;_blank&#34;&gt;Rolling Stone&lt;/a&gt; in 2017 on Alex Ovechkin.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Beware of snake oil when it comes to postseason predictions. If it seems to good to be true, it probably is. As a hypothetical example, if a company says it can predict MLB or NHL series outcomes with 85-percent accuracy, perhaps avoid hiring that company to be the official sponsor of your league&amp;rsquo;s stats page.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;summary&#34;&gt;Summary&lt;/h2&gt;

&lt;p&gt;This post was long, but the varying formats and differing levels of league skill make postseason tournament outcomes in the MLB, NBA, NFL, and NHL complex to contrast. For team officials, coaches, players, and fans, an acknowledgement of the operating characteristics of each league can improve our overall understanding of how and when teams win in postseason play.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Footnotes&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;*We likely underestimated the deterministic nature of the NBA in our article. To derive team strengths, we used regular season data. However, stars play a more dominant role in the NBA&amp;rsquo;s postseason, which means it can be difficult to pick up on how teams like Golden State or Cleveland will improve from their regular season results.&lt;/p&gt;

&lt;p&gt;**The NFL is perfect and that is an unbiased opinion.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Note: This is Part II in a set of posts of how betting markets can inform sports fans. To return to the series homepage, click &lt;a href=&#34;http://statsbylopez.netlify.com/post/lessons-hidden-in-sports-betting-markets/&#34; target=&#34;_blank&#34;&gt;here&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Part III: Rocky Mountain High (the benefit of playing at home)</title>
      <link>/post/playing-at-home/</link>
      <pubDate>Wed, 22 Aug 2018 00:00:00 +0000</pubDate>
      
      <guid>/post/playing-at-home/</guid>
      <description>&lt;p&gt;One way in which professional sports are relatively fair is that, in each season, teams are almost always given an identical number of home games. This seems like an obvious way to run a sports organization, until you remember that postseason berths in NCAA hoops and football often hinge on incredibly unbalanced schedules.&lt;/p&gt;

&lt;p&gt;Playing at home is a benefit, and while the reasons for the overall advantage are somewhat up for &lt;a href=&#34;https://www.amazon.com/dp/B004C43GC4/ref=dp-kindle-redirect?_encoding=UTF8&amp;amp;btkr=1&#34; target=&#34;_blank&#34;&gt;debate&lt;/a&gt;, there &lt;em&gt;are&lt;/em&gt; obvious and unique advantages that make playing at home different each sport.&lt;/p&gt;

&lt;p&gt;In our cross-sport paper, Ben designed a pretty amazing chart that highlights, on a probability scale, how the home advantage compares both by sport and franchise. Bars for each term correspond to 95% credible intervals.&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;/img/home_benefit.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;It is substantially more beneficial to play at home in the NBA, and to a lesser extent the NFL, than it is in MLB and the NHL. This isn&amp;rsquo;t surprising, and confirms what several authors before us have found.&lt;/p&gt;

&lt;p&gt;What was most intriguing, however, is if and how teams &lt;em&gt;within&lt;/em&gt; each league varied.&lt;/p&gt;

&lt;p&gt;Take the NBA, where the difference between the best home advantage (Denver, Utah) and the worst (Brooklyn) is enormous. The estimates above average out to be roughly &lt;em&gt;2.5 extra wins per year&lt;/em&gt;, in expectation, that Denver and Utah get that Brooklyn doesn&amp;rsquo;t, just by virtue of where the teams play. Using &lt;a href=&#34;https://www.brewhoop.com/2016/8/8/12354486/value-in-the-nba-whats-the-value-of-a-win&#34; target=&#34;_blank&#34;&gt;back-of-envelope&lt;/a&gt; calculations with respect to the value of a win in the NBA, the home advantage for Denver and Utah is worth about $5 million annually. This is incredible, particularly given that the marginal value of a win for Denver and Utah (good but not great teams, traditionally) is likely higher.&lt;/p&gt;

&lt;p&gt;There were likewise modest between-team differences in the home advantage in the NHL &amp;ndash; one taken to the extreme this &lt;a href=&#34;http://statsbylopez.netlify.com/post/the-vegas-flu-looks-real/&#34; target=&#34;_blank&#34;&gt;past year by Vegas&lt;/a&gt; &amp;ndash; while within each of the NFL and MLB, team-level home advantages are mostly the same.&lt;/p&gt;

&lt;p&gt;How can this help folks on teams? Here&amp;rsquo;s a short list.&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;Be cognizant of the home advantage when allocating resources at the end of the regular season to secure additional home games in the postseason. As an example, it makes more sense to rest a star starting pitcher in MLB but lose a relatively small home advantage than it does to rest a star quarterback in the NFL and lose a relatively big home advantage.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Resist the temptation of worrying about the home-advantages in a 7-game series in MLB (and to a lesser extend the NHL). The home advantage only matters if the series goes to 7-games, and if it does go to 7-games, it&amp;rsquo;ll be, relatively speaking, a tiny benefit.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Recognize the difficulty of playing in Denver and Utah with respect to travel, rest, line-up usage, and the distribution of playing time. It&amp;rsquo;s not just the NBA &amp;ndash; both the Broncos and Rockies rate first in their leagues in terms of the benefit to playing at home.&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;em&gt;Note: This is Part III in a set of posts of how betting markets can inform sports fans. To return to the series homepage, click &lt;a href=&#34;http://statsbylopez.netlify.com/post/lessons-hidden-in-sports-betting-markets/&#34; target=&#34;_blank&#34;&gt;here&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Part IV: The Orioles should have traded Manny Machado to the Dodgers for a spot in the NL West (on schedule strength)</title>
      <link>/post/part-iv-schedule-strength/</link>
      <pubDate>Wed, 22 Aug 2018 00:00:00 +0000</pubDate>
      
      <guid>/post/part-iv-schedule-strength/</guid>
      <description>

&lt;h2 id=&#34;taking-a-step-back&#34;&gt;Taking a step back&lt;/h2&gt;

&lt;p&gt;Most of sports analytics involve decisions made on the margins. We debate fourth down decisions that, across a season, add up to roughly a &lt;a href=&#34;https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3114242&#34; target=&#34;_blank&#34;&gt;a third of an expected win&lt;/a&gt;. We compare the merit of Cy Young candidates, when the relative difference of &lt;a href=&#34;https://legacy.baseballprospectus.com/sortable/index.php?cid=2508773&#34; target=&#34;_blank&#34;&gt;each candidate&amp;rsquo;s WAR&lt;/a&gt; equates to nothing more than rounding errors. We tell NHL coaches to pull their goalie a few minutes earlier, knowing that, in more seasons than not, not an extra point will be gained by going so.&lt;/p&gt;

&lt;p&gt;Thus, perhaps it&amp;rsquo;s worth taking a step back to analyze what can be a substantially more dominant but often unquantified force that impacts sporting results: who you opponents are.&lt;/p&gt;

&lt;h2 id=&#34;the-tougest-division-in-sports&#34;&gt;The tougest division in sports&lt;/h2&gt;

&lt;p&gt;What if teams played balance schedules? In other words, how would standings have looked if each team were to play the same set of teams that every other team plays?*&lt;/p&gt;

&lt;p&gt;Using our estimates of team strength (that vary by season and week) and home advantage (which vary between teams, most notably in the NHL and NBA), that&amp;rsquo;s the question I sought to answer. To do so, I compared how each team&amp;rsquo;s expected win total would have changed if they were to each play the same caliber opponent throughout a season. Note that this finding is not in our paper, but is at the heart of a talk I gave at the &lt;a href=&#34;https://statsbylopez.github.io/Toronto18/Toronto18.html&#34; target=&#34;_blank&#34;&gt;Fields Sports Analytics Conference in May.&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Here&amp;rsquo;s a quick summary of the results: given their schedules, no set of teams has been more consistently and more strongly hurt than those in MLB&amp;rsquo;s American League East.&lt;/p&gt;

&lt;p&gt;Here&amp;rsquo;s a chart that shows the yearly impact (in terms of wins added or lost) for each AL East team that comes as a function of them simply playing the schedule they were assigned to play.&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;/img/ALEast1.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;A negative y-axis means a drop in wins. In other words, the chart shows that by playing in the AL East, the Orioles lose, on average, about three wins a year than what their talent suggests they otherwise deserve. The rest of the AL East isn&amp;rsquo;t far behind.&lt;/p&gt;

&lt;p&gt;The explanation is somewhat obvious: MLB currently requires teams to play each intra-divisional opponent 19 times. That means each of the Orioles, Blue Jays, and Rays have to face the Red Sox or Yankees, two of the league&amp;rsquo;s top teams in most years, in about 1 in 4 contests. There&amp;rsquo;s no equivalent in the other leagues, nor anything close.&lt;/p&gt;

&lt;p&gt;Such a set up hurts teams in the AL East for two reasons. First, because these AL East teams are winning less often than they otherwise should be, they are less likely to qualify for the playoffs simply by having fewer wins than teams in other divisions. Second, because the only way to earn an automatic MLB playoff spot is to win your division, these teams have an uphill battle in that sense in that they also have to overtake the Red Sox or Yankees in the standings.&lt;/p&gt;

&lt;p&gt;Quite frankly, when the Orioles went to trade Manny Machado, nothing would have been more valuable in terms of a return than a spot in a different division.&lt;/p&gt;

&lt;h2 id=&#34;the-best-fans-in-baseball-are-also-the-luckiest&#34;&gt;The best fans in baseball are also the luckiest&lt;/h2&gt;

&lt;p&gt;Whereas teams in the AL East have frequently been punished by virtue of being in a division with two typically great teams and generally no awful teams (2018 aside), the NL Central has generally been the opposite; typically no elite teams, and often a few terrible ones. Between 2006 and 2017, for example, St. Louis averaged +2.2 annual wins added due to an easy schedule. Across North American pro sports, that&amp;rsquo;s the greatest average benefit for any particular team.&lt;/p&gt;

&lt;p&gt;The 2011 campaign is a particularly poignant anecdote. That year, in the same division as the Astros (56 wins, and with a run differential of -181), the Cardinals (90 wins) made the playoffs as a wild card team by exactly one game over the Atlanta Braves (89 wins). Over in the AL, the Red Sox (also 90 wins) missed the playoffs altogether. Given the randomness of postseason baseball outcomes, making the playoffs made all the difference for that Cardinals team. With a playoff berth they likely only got due to an easy schedule, the 2011 Cardinals team went on to win the World Series.&lt;/p&gt;

&lt;p&gt;Even better for the Cardinals? The Astros, about to become a dominant team, moved to the American League one year later.&lt;/p&gt;

&lt;h2 id=&#34;summary&#34;&gt;Summary&lt;/h2&gt;

&lt;p&gt;Here&amp;rsquo;s a summary of other notable findings regarding schedule strength:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;The impact of MLBs schedule remains the biggest in pro sports even when accounting for its longer regular season (and thus a larger spread of wins from team to team). See &lt;a href=&#34;https://statsbylopez.github.io/Toronto18/Toronto18.html#section-5&#34; target=&#34;_blank&#34;&gt;this slide.&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;The NFL ranks second in terms of the relative impact of a team&amp;rsquo;s schedule on its number of wins; however, by and large, changes in schedule strength from one year to the next are mostly noise, and more sympotmatic of the relatively small number of games each team plays.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Schedule strength plays a smaller role in both the NBA and NHL. In that regard, wins (or points) at the end of the regular season make for a decent proxy for overall team skill.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;The impact of rest &amp;ndash; that is, having more rest than your opponent &amp;ndash; is also something that I looked at. The &lt;a href=&#34;https://statsbylopez.github.io/Toronto18/Toronto18.html#section-2&#34; target=&#34;_blank&#34;&gt;role of rest&lt;/a&gt; is largest in the NBA, followed, in order, by the NHL, NFL, and MLB. Recent steps taken by the NBA to both reduce the frequency of back-to-backs and the differences between teams in terms of number of back-to-backs are appreciated in this regard, and clearly supported by data.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;West coast teams, in general, are given more rest advantages than their East coast brethren. This likely has contributed to why West coast teams often show up as having the largest home advantages: what was really a rest advantage was often perceived as a home advantage.&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Altogether, the accurate nature of our team strength metrics has allowed us to consider outside-the-box comparisons like those presented above. In particular, the unbalanced schedule of MLB stands out as one league-level factor that, while potentially good for Sunday Night Baseball ratings, may unfairly penalize certain teams.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Note: This is Part IV in a set of posts of how betting markets can inform sports fans. To return to the series homepage, click &lt;a href=&#34;http://statsbylopez.netlify.com/post/lessons-hidden-in-sports-betting-markets/&#34; target=&#34;_blank&#34;&gt;here&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;*Teams cannot, of course, play themselves, and so even in the hypothetical scenario with balanced scheduled, good teams would have slightly easier schedules and bad teams would have slightly more difficult schedules.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>The within-game evolution of MLB’s strike zone</title>
      <link>/post/the-within-game-evolution-of-mlb-s-strike-zone/</link>
      <pubDate>Fri, 01 Jun 2018 00:00:00 +0000</pubDate>
      
      <guid>/post/the-within-game-evolution-of-mlb-s-strike-zone/</guid>
      <description>&lt;p&gt;Baseball games are &lt;a href=&#34;https://www.nytimes.com/2017/03/01/sports/baseball/baseballs-too-slow-heres-how-you-fix-it.html&#34;&gt;too slow&lt;/a&gt;, &lt;a href=&#34;https://slate.com/culture/2018/05/major-league-baseball-games-are-too-long-heres-how-to-make-them-longer.html&#34;&gt;too long&lt;/a&gt;, &lt;a href=&#34;https://www.sbnation.com/a/mlb-2017-season-preview/game-length&#34;&gt;so damned long&lt;/a&gt;, and, like my seven-year old daughter getting dressed in the morning, &lt;a href=&#34;https://fivethirtyeight.com/features/baseballs-biggest-games-are-taking-forever/&#34;&gt;taking forever&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Despite the headlines, there’s one aspect of the game that has actually worked to speed the game up: how umpires call balls and strikes. As one piece of evidence, Brian and I found that, in the bottom half of extra innings, &lt;a href=&#34;https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3129084&#34;&gt;calls tend to favor&lt;/a&gt; whichever team is closer to winning. By that point in the game, we argue, &lt;a href=&#34;https://fivethirtyeight.com/features/everyone-wants-to-go-home-during-extra-innings-maybe-even-the-umps/&#34;&gt;everyone wants to go home&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Although our evidence is strong that umpires react to the scoreline in extra innings, given the frequency with which these games happen, such extra bits of discretion are only likely to impact a game or two a week. Meanwhile, innings one through nine have, to the best of my knowledge, to-date gone unanalyzed with respect to a varying strike zone. But with the score-state for each game now available on &lt;a href=&#34;https://baseballsavant.mlb.com/&#34;&gt;baseballsavant&lt;/a&gt;, I figured a look at all innings would be more appropriate.&lt;/p&gt;
&lt;p&gt;First, I used the &lt;code&gt;baseballr&lt;/code&gt; package to acquire pitch-level data for all balls and strike calls between the 2008 and 2017 seasons (scraping code &lt;a href=&#34;https://github.com/statsbylopez/mlb-shirking/blob/master/Code/scraping.R&#34;&gt;here&lt;/a&gt;). For each pitch, I adjusted the corresponding vertical coordinate to standardize for each batter personal strike zone.&lt;/p&gt;
&lt;p&gt;Next, I averaged across each of the nine-innings and each three-inch window of a strike zone grid to identify the likelihood of a pitch in a given part of the zone being called a strike. Finally, as a baseline, I focused on the differences between each score state where one team is leading (by 1 to 3 runs, or by 4 runs or more), relative to the game being tied, done separately for each inning.&lt;/p&gt;
&lt;p&gt;Here’s a gif that works through how the strike zone changes by inning and score state. Shades of the graph in green correspond to more strikes, while purple reflects fewer strikes. You shouldn’t see much early. But please wait for the 9th-inning.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/img/output_inning.gif&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Late in games, beginning with the 8th-inning, there’s a marked increase in strike calls when one of the teams is leading. Differences are as large as 30 percentage points in the 9th-inning, and seem somewhat consistent between types of leads. This latter point is important – if the strike zone expands as equally with a 2-run lead as it does with a 12-run lead, we can be more confident that what’s driving the expansion isn’t the insertion of a star closer, as those players are only likely to be pitching with small leads.&lt;/p&gt;
&lt;p&gt;Why does this matter?&lt;/p&gt;
&lt;p&gt;For starters, let’s think about closers in general. MLB managers traditionally save their best relief pitcher for the 9th inning, with several of these players turning into generational stars that can occassionally get &lt;a href=&#34;https://thebiglead.com/2013/05/15/mariano-rivera-gets-quite-a-generous-strike-zone/&#34;&gt;strike-calls&lt;/a&gt; on balls crossed that cross into the batter’s box. But if part of why closers are perceived to be so valuable is that, in general, the strike zone is wider in the 9th-inning, perhaps that may say something about the fluidity of this role.&lt;/p&gt;
&lt;p&gt;Precisely answering this question is less straightforward, however, as there are several pitchers who have only performed in one type of spot (set-up or closer), but not both. This can be problematic from a causation standpoint, as perhaps there are different characteristics about pitchers who pitch the 9th-inning – ones that also lead to more strike calls – that are responsible for the increase. However, one way around this issue is to look only at pitchers who have performed in both roles.&lt;/p&gt;
&lt;p&gt;Here’s a chart comparing differences in strike rates between the 9th and 8th innings, using situations where the pitching team has a small lead (defined as between one and four runs). In the 9th-inning, this is traditionally the spot where teams use a closer. To lessen the worry about the impact of certain pitchers, I used only the 113 pitchers who threw at least 250 pitches in each inning in this specific situation (tight lead) between 2008 and 2017.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/img/output_98.png&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Across most fringe areas of the strike zone, there’s between a 5 and 10 percentage point increase in the likelihood of a strike when looking in 9th-inning pitches. In other words, even among the pitchers who tend to pitch the most, and even when considering only one specific type of situation (pitching with a tight lead), it’s better to be on the mound in the 9th-inning than in the 8th-inning.&lt;/p&gt;
&lt;p&gt;It’s worth noting that the above, to this point, is but an aggregated summary of strike rates based on a few game characteristics. Thus, there may be explanations besides umpire discretion that drive differences in strike zone size late in games. As one alternative possibility, … actually, I can’t think of one. But maybe you can?&lt;/p&gt;
&lt;p&gt;In any case, for now, we note that MLB umpires tend to call higher rates of strikes late in games when one team has a lead. Moreover, there’s a particular jump in the ninth-inning. These findings are potentially explained by an effort to speed up the game, and cannot be fully explained by a preference for star relief pitchers.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Rethinking draft curves</title>
      <link>/post/rethinking-draft-curve/</link>
      <pubDate>Wed, 25 Apr 2018 00:00:00 +0000</pubDate>
      
      <guid>/post/rethinking-draft-curve/</guid>
      <description>&lt;p&gt;When the Jets traded pick No. 6, No. 37, No. 49, and a 2019 pick to the Colts for pick No. 3, I broke out my trusty &lt;a href=&#34;https://statsbylopez.com/2016/06/22/the-making-and-comparison-of-draft-curves/&#34;&gt;draft curve&lt;/a&gt; to see what it said about the trade.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr class=&#34;header&#34;&gt;
&lt;th align=&#34;center&#34;&gt;Pick Number&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Value&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Team&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;52.5&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;to the Jets&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;50.6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;to the Colts&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;37&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;33.5&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;to the Colts&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;49&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;28.3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;to the Colts&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Even when you ignore the 2019 pick conveyed to the Colts, the Jets are enormous losers. To be more specific, the Colts aquired 112.4 points worth of draft value in exchange for 52.5 points. Or, perhaps a better way of putting this deal: had the Jets also received back the first pick in the deal, they would’ve just about broken even.&lt;/p&gt;
&lt;p&gt;These findings accord with just about every take I saw on the trade that came from analytically-minded sources. Even on Jimmy Johnson’s outdated version of the trade chart, &lt;a href=&#34;https://ftw.usatoday.com/2018/03/nfl-jets-colts-draft-trade-richard-thaler-nobel-prize&#34;&gt;Indianapolis&lt;/a&gt; comes out ahead.&lt;/p&gt;
&lt;p&gt;But still, something didn’t pass the smell test, and I figured it was worth a go at revisiting my draft curve.&lt;/p&gt;
&lt;div id=&#34;what-if-a-team-wants-a-superstar&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;What if a team wants a superstar?&lt;/h2&gt;
&lt;p&gt;One limitation of the draft curve above is that it focuses on the &lt;em&gt;average&lt;/em&gt; player performance. For the Jets, pick. No. 3 is worth an &lt;em&gt;average&lt;/em&gt; value of 52.5 points over the course of a career (for those scoring at home, this is reflects a player’s career &lt;a href=&#34;https://www.pro-football-reference.com/blog/index37a8.html&#34;&gt;Approximate Value&lt;/a&gt;). But a team may not be drafting for average player performance, and instead, may prefer a shot at a superstar. How can we tweak our draft curve to account for this team preference?&lt;/p&gt;
&lt;p&gt;Instead of focusing on a smoothed average at each line, we can instead set a cutoff for what it means to be a superstar, and adjust our valuation of each pick to estimate the likelihood of landing a player above that cutoff. There are several reasons to  do this, and I generally dislike setting arbitrary &lt;a href=&#34;http://statsbylopez.netlify.com/post/on-the-risks-of-categorizing-a-continuous-variable/&#34;&gt;cutoffs&lt;/a&gt;. However, there are two benefits of thinking this way. First, the valuations of each pick – the likelihood of landing a superstar – are easy to interpret, which may help in the communication of results. Second, only 11 players are allowed on the field at a given time, and so even if you nail a bunch of 7th round picks, you can’t play them all at once.&lt;/p&gt;
&lt;p&gt;There are several ways to identify a super-star. For ease of implementation, I identified the players in the top &lt;code&gt;21/22&lt;/code&gt; percentile, which is a very rough estimation of whether or not that player could have been identified as the best player on the field at any given time point. Using career AV as an outcome, this corresponds with players with a career AV greater than 66. Here’s a sample of players just above and just below the cutoff.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr class=&#34;header&#34;&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Pos&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;CarAV.projected&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Star&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;Reggie Nelson&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;DB&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;63&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FALSE&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;Thomas Jones&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RB&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;62&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FALSE&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;Adrian Wilson&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;DB&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;64&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;FALSE&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;Brian Westbrook&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;RB&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;69&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;TRUE&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;Lawrence Timmons&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;LB&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;72&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;TRUE&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;Tra Thomas&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;T&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;69&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;TRUE&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Among the players meeting our star criterion listed above, Westbrook, Timmons, and Thomas all made the Pro Bowl at least once in their careers, and each player was also named to at least one all-Pro team, so this seems like a reasonable cutoff to make.&lt;/p&gt;
&lt;p&gt;Here’s a side-by-side comparison of the two competing charts. On the left is my original draft curve, and on the right is the superstar-specific one.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/post/2018-04-25-building-a-better-draft-curve_files/figure-html/unnamed-chunk-4-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;There are notable differences between the two curves. Primarily, the &lt;code&gt;superstar&lt;/code&gt; curve on the right features a much steeper cutoff than the &lt;code&gt;average&lt;/code&gt; curve. The &lt;code&gt;superstar&lt;/code&gt; curve also makes it quite clear that by pick 100, it is exceedingly unlikely to land a superstar player.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;revising-the-jets-trade&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Revising the Jets trade&lt;/h2&gt;
&lt;p&gt;Here’s a look at the Jets/Colts trade using the superstar-based curve.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr class=&#34;header&#34;&gt;
&lt;th align=&#34;center&#34;&gt;Pick Number&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Value&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Team&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0.32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;to the Jets&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0.29&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;to the Colts&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;37&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0.09&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;to the Colts&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;49&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0.07&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;to the Colts&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Although it’s not exactly quite right to simply add these percentages, the Jets’ return of pick No. 3 (32% chance of a star) looks a bit more reasonable. Using the star rates as pick values, the Jets gained 32 points worth of value in exchange for 43 points. That’s the equivalent of losing out on about the 27th pick in the draft (which is much more reasonable than losing out on the 1st pick in the draft).&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;building-the-best-curve&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Building the best curve&lt;/h2&gt;
&lt;p&gt;Perhaps a better draft curve incorporates both overall average pick performance &lt;em&gt;and&lt;/em&gt; star likelihood. To do that, I scaled the curves above so that they each had the same total draft valuation, took an average, and then re-scaled that average so that the first pick was worth a value of 1.&lt;/p&gt;
&lt;p&gt;Here’s that curve. The curve in the middle (shown in purple) reflects the average between the &lt;code&gt;average&lt;/code&gt; and &lt;code&gt;superstar&lt;/code&gt; curves.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/post/2018-04-25-building-a-better-draft-curve_files/figure-html/unnamed-chunk-6-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Using the so-called &lt;code&gt;blended&lt;/code&gt; draft curve, here’s a final look at the Jets/Colts trade.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr class=&#34;header&#34;&gt;
&lt;th align=&#34;center&#34;&gt;Pick Number&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Value&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Team&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;27.8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;to the Jets&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;25.4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;to the Colts&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;center&#34;&gt;37&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;10.8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;to the Colts&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;center&#34;&gt;49&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;8.7&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;to the Colts&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;The Colts still made out like bandits – roughly getting about a 60% rate or return on their No. 3 pick – but it doesn’t look as egregious as it initially did. Roughly, the Colts got value worth about the 20th pick in the draft for free by this blended approach.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;final-thoughts&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Final thoughts&lt;/h2&gt;
&lt;p&gt;A blended draft curve is by no means final, but it’s one approach for considering how teams aren’t just drafting for average value, and that they are often looking for a superstar. I should also note that this isn’t my idea at all – Michael Schuckers wrote about it in JQAS, a paper you can read &lt;a href=&#34;http://statsportsconsulting.com/main/wp-content/uploads/Schuckers_JQAS_NFL_Draft.pdf&#34;&gt;here&lt;/a&gt;. Schuckers uses a blend of outcomes to make a final draft curve, and there’s no reason to suspect that mine is any better than his.&lt;/p&gt;
&lt;p&gt;Teams &lt;em&gt;should&lt;/em&gt; be doing deeper research into making similar curves for themselves. These &lt;em&gt;should&lt;/em&gt; include the salary for each pick, our could use better cutoffs to reflect what they are looking for in players (superstar, consistent starter, etc). But for now, hopefully it makes a bit of sense why an initial, smoothed draft curve may be limited.&lt;/p&gt;
&lt;p&gt;If you want to evaluate trades yourself using the blended curve, I uploaded a table &lt;a href=&#34;https://docs.google.com/spreadsheets/d/15_doA989vn-JoWYqktRU3yLH7ciHB4Jd8RS1m2erGZo/edit?usp=sharing&#34;&gt;here&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>The Vegas flu looks real — but somehow the Chicago Blackhawks also got sick</title>
      <link>/post/the-vegas-flu-looks-real/</link>
      <pubDate>Wed, 11 Apr 2018 00:00:00 +0000</pubDate>
      
      <guid>/post/the-vegas-flu-looks-real/</guid>
      <description>&lt;p&gt;In yesterday’s post, I walked through the use of a &lt;a href=&#34;http://statsbylopez.netlify.com/post/a-state-space-model-to-evaluate-sports-teams/&#34;&gt;state-space&lt;/a&gt; model to evaluate NHL team strength over the course of an NHL season.&lt;/p&gt;
&lt;p&gt;But analyzing team strength is just the start of how we can use this type of framework to analyze betting market data in sports. In today’s post, I’ll ask a different question – What team had the best home advantage? And did perceptions of any teams (cough cough, Vegas) change over the course of the season?&lt;/p&gt;
&lt;div id=&#34;the-vegas-flu&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;The Vegas Flu&lt;/h2&gt;
&lt;p&gt;Around mid-December – according to a Google search, &lt;a href=&#34;http://www.espn.com/nhl/story/_/id/21825994/nhl-vegas-flu-real-golden-knights-stunning-home-success&#34;&gt;December 20th&lt;/a&gt; – the public became aware of the Golden Knights’ incredible start at home. Vegas started the season 14-2-1 at T-Mobile Arena, shocking pre-season &lt;a href=&#34;http://www.espn.com/nhl/story/_/id/20841111/2017-18-nhl-season-preview-vegas-golden-knights&#34;&gt;predictions&lt;/a&gt; that had the Golden Knights as one of the worst teams in hockey.&lt;/p&gt;
&lt;p&gt;Yesterday’s post used a time-varying model of team strength that, while able to pick up on changes in team strength with Vegas, also assumed that (i) each NHL team had the same home advantage and (ii) there was no impact of team rest on market numbers. However, both of these assumptions are testable with by adding a few more variables to our model.&lt;/p&gt;
&lt;p&gt;Here was our initial model:
&lt;span class=&#34;math display&#34;&gt;\[
\text{E}[\text{logit}(p_{i,j,w})] = \theta_{i,w} - \theta_{j,w} + \alpha,
\]&lt;/span&gt;
We expand that model to
&lt;span class=&#34;math display&#34;&gt;\[
\text{E}[\text{logit}(p_{i,j,w})] = \theta_{i,w} - \theta_{j,w} + \alpha_i,
\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;which allows for each team &lt;span class=&#34;math inline&#34;&gt;\(i\)&lt;/span&gt; to have its own intercept. But we’re not done yet. The final model,&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[
\text{E}[\text{logit}(p_{i,j,w})] = \theta_{i,w} - \theta_{j,w} + \alpha_i + \beta_1*Rest_i + \beta_2*Rest_j,
\]&lt;/span&gt;
includes binary indicators &lt;span class=&#34;math inline&#34;&gt;\(Rest_i\)&lt;/span&gt; and &lt;span class=&#34;math inline&#34;&gt;\(Rest_j\)&lt;/span&gt; which indicate whether or not the home (&lt;span class=&#34;math inline&#34;&gt;\(i\)&lt;/span&gt;) or away (&lt;span class=&#34;math inline&#34;&gt;\(j\)&lt;/span&gt;) team was better rested prior to the game. Note that for rest variables, if both teams had the same rest, or both teams had at least one day of rest, these indicators were set to 0. Rest variables are important, as we hope to be able to tease out the benefit of playing at home from the benefit of playing a non-rested opponent at home.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;are-home-advantages-different&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Are home advantages different?&lt;/h2&gt;
&lt;p&gt;Yes, it appears they are.&lt;/p&gt;
&lt;p&gt;Here’s a plot of the posterior distribution of &lt;span class=&#34;math inline&#34;&gt;\(\alpha_i\)&lt;/span&gt; for each team &lt;span class=&#34;math inline&#34;&gt;\(i\)&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/img/vegas1.png&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Each teams’ curve corresponds to their estimated prediction of beating an equal-caliber opponent at home. League-wide, the average is about 55%, but some teams lie above and below that average.&lt;/p&gt;
&lt;p&gt;Overall, betting markets linked Vegas with the best home advantage during the 2017/18 season, as judged by the posterior distribution of the Golden Knights’ &lt;span class=&#34;math inline&#34;&gt;\(\alpha\)&lt;/span&gt;. However, we can be more precise: there’s about a 90% chance (using the overlap in the density curves) that Vegas was given a better home adjustment than the second best team (LA Kings). Altogether, the gaps between teams with the best and worst home advantages appear unlikely to be due to chance, which matches our findings in our original paper (&lt;a href=&#34;https://arxiv.org/abs/1701.05976&#34;&gt;link&lt;/a&gt;).&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;did-home-advantages-change&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Did home advantages change?&lt;/h2&gt;
&lt;p&gt;I replicated the same model fit above using both games before and after December 20th. Why that date? First, it’s the date of the ESPN article that publicized the idea of the Vegas Flu. Second, it’s close enough to the halfway mark of the season that it’s likely we have enough home games to judge each team with.&lt;/p&gt;
&lt;p&gt;Here’s the Golden Knights’ home advantage, both before (dark curve) and after (light curve) December 20th.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/img/vegas2.png&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Altogether, it looked like the Knights’ expected win percentage at home was given about a 1.75 percentage point bump after December 20th. This appears significant – but there’s also enough overlap in the two density curves that the increase could be due to chance. From a practical standpoint, this increase would plausibly effect the outcome of no more a game or two – but from a betting market standpoint, an increase of 1.75 percentage points is notable.&lt;/p&gt;
&lt;p&gt;Of course, it’d be more precise to consider the Golden Knights’ increase in light of changes to the home advantage intercepts among other teams.&lt;/p&gt;
&lt;p&gt;Here’s a plot with &lt;em&gt;every&lt;/em&gt; teams’ density curves, showing the home advantage both before (in dark) and after (in color) December 20th. Curves shaded in red reflect teams where the home advantage decreased – teams in blue correspond with an increase. I also organized teams in a weird order – from those with the biggest drop (Chicago) to the biggest increase (Vegas).&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/img/vegas3.png&#34; /&gt;&lt;/p&gt;
&lt;p&gt;I feel a bit like Jack Buck here: I can’t believe what I just saw.&lt;/p&gt;
&lt;p&gt;The team with the biggest change in home advantage is not Vegas but Chicago, which observes an estimated win percentage drop by nearly 2 percentage points. Edmonton and Montreal, the two franchises that, combined with the Blackhawks, had the three most disappointmenting seasons in the NHL, also observe drops in perceived home advantage.&lt;/p&gt;
&lt;p&gt;What does this suggest?&lt;/p&gt;
&lt;p&gt;There are likely two possibilities.&lt;/p&gt;
&lt;p&gt;First, market-perceived home advantage correlates to team strength. If the Blackhawks or Oilers stink, it is reasonable to think that playing in Chicago or Edmonton is less of worry for opponents. Fewer fans are showing up, referees are less likely to give the home team a call, and the home team is, even after accounting for team strength, a hair less likely to win.&lt;/p&gt;
&lt;p&gt;Second, which is an important caveat, our model can’t pick up when teams play different players (e.g. backup goalies). In other words, if opponents started the year playing their backups in Chicago, but ended the year playing their starters at Chicago, we’d likely be calling what was really a change in opponent behavior a change in home advantage. Alternatively, if the Blackhawks started the year playing Corey Crawford in net for all of their home games but ended the year playing, for sake of argument, a beer-league goalie off of the street, our model would not pick up on that.&lt;/p&gt;
&lt;p&gt;Either way, hopefully this post highlights some of the potential that can be found when analyzing market numbers. We can be sure that the market values each teams’ home advantage different, and that by years’ end, Vegas was given the biggest adjustment when playing at home. It’s also possible that how the market views each teams home advantage is tied to how good that team is at a particular time point.&lt;/p&gt;
&lt;/div&gt;
</description>
    </item>
    
  </channel>
</rss>
